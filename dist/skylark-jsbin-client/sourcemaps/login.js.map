{"version":3,"sources":["login.js"],"names":["define","$","pushState","window","history","url","$forms","$info","currentPath","firstrun","$formcontainer","$tabs","click","event","fromPopstate","path","target","pathname","parentNode","hide","filter","this","getAttribute","indexOf","matchActionAttrTo","show","removeClass","preventDefault","addClass","slice","addEventListener","handlePopstateChanges","on","$form","data","getFormData","ajax","attr","type","dataType","success","res","location","href","referrer","error","showInfo","find","html","responseJSON","message","$loginForm","text","setTimeout","val","email","username","origin","currentForm","trigger","serializeArray","reduce","obj","item","name","value"],"mappings":";;;;;;;AACAA,QACE,kBACA,SAASC,GACT,aAEA,IAAIC,IAAYC,OAAOC,QAAQF,WAAY,SAAUG,GACnDF,OAAOC,QAAQF,UAAU,KAAM,KAAMG,IAGvC,GAAMH,EAAN,CAIA,IAAII,EAASL,EAAE,4CACXM,EAAQN,EAAE,6CACVO,EAAc,KACdC,GAAW,EAgCXC,EAAiBT,EAAE,uCACnBU,EAAQV,EAAE,6BAA6BW,MAAM,SAAUC,EAAOC,GAChE,IAAIC,EAAOF,EAAMG,OAAOC,UAAYJ,EAAMG,OAAOE,WAAWD,SAI5D,GAAKf,GAAcY,EAAnB,CAKA,GAAIN,IAAgBO,EAClB,OAAO,EAGTP,EAAcO,EAEdT,EACGa,OACAC,OAjCL,SAA2BL,GACzB,OAAO,WACL,OAAsD,IAA/CM,KAAKC,aAAa,UAAUC,QAAQR,IA+BnCS,CAAkBT,IACzBU,OAEEhB,EAGHA,GAAW,EAtDNF,EAAMmB,YAAY,WA4DpBZ,GAAgBZ,GACnBA,EAAUa,GAGZF,EAAMc,iBAENjB,EACGgB,YAAY,kBACZE,SAASb,EAAKc,MAAM,OAIzB1B,OAAO2B,iBAAiB,WAAYC,GACpCA,IAEAzB,EAAO0B,GAAG,SAAU,SAASnB,GAC3BA,EAAMc,iBACN,IAAIM,EAAQhC,EAAEY,EAAMG,QAEhBkB,EAAOC,EAAYF,GAEvBhC,EAAEmC,MACA/B,IAAK4B,EAAMI,KAAK,UAChBC,KAAML,EAAMI,KAAK,UACjBH,KAAMA,EACNK,SAAU,OACVC,QAAS,SAASC,GAChBtC,OAAOuC,SAASC,KAAOF,EAAIG,UAE7BC,MAAO,SAASJ,GACdK,IAAWC,KAAK,KAAKC,KAAKP,EAAIQ,aAAaC,cAMjD,IAAIC,EAAalD,EAAE,UACnBA,EAAE,aAAaW,MAAM,SAAUC,GA8B7B,OA7BAA,EAAMc,iBAENmB,IAAWC,KAAK,KAAKK,KAAK,sCAE1BC,WAAW,WAGT,GAFYpD,EAAE,mBAAmBqD,MAEtB,CACT,IAAIpB,EAAOC,EAAYgB,GACvBjB,EAAKqB,MAAQrB,EAAKsB,SAClBvD,EAAEmC,MACA/B,IAAKF,OAAOuC,SAASe,OAAS,UAC9BnB,KAAM,OACNJ,KAAMA,EACNK,SAAU,OACVC,QAAS,SAAUN,GACjBY,IAAWC,KAAK,KAAKK,KAAKlB,EAAKgB,SAAWhB,EAAKW,QAEjDA,MAAO,SAAUJ,GACf,IAAIP,EAAOO,EAAIQ,aACfH,IAAWC,KAAK,KAAKK,KAAKlB,EAAKW,OAASX,EAAKgB,iBAIjDJ,IAAWC,KAAK,KAAKK,KAAK,4GAG3B,MAEI,IA5HT,SAASN,IACP,OAAOvC,EAAMqB,SAAS,UAGxB,SAAS8B,IACP,OAAOrC,KAAKJ,WAAad,OAAOuC,SAASzB,SAG3C,SAASc,IACPpB,EAAMS,OAAOsC,GAAaC,QAAQ,UAAU,IAS9C,SAASxB,EAAYF,GACnB,OAAOA,EAAM2B,iBAAiBC,OAAO,SAAUC,EAAKC,GAGlD,OADAD,EADWC,EAAKC,MACJD,EAAKE,MACVH","file":"../login.js","sourcesContent":["/* globals $ */\r\ndefine([\r\n  \"skylark-jquery\"\r\n],function($){\r\n  'use strict';\r\n\r\n  var pushState = window.history.pushState ? function (url) {\r\n    window.history.pushState(null, null, url);\r\n  } : false;\r\n\r\n  if ( !pushState) {\r\n    return;\r\n  }\r\n\r\n  var $forms = $('#login-register-page.form-container form');\r\n  var $info = $('#login-register-page.form-container .info');\r\n  var currentPath = null;\r\n  var firstrun = true;\r\n\r\n  function hideInfo() {\r\n    return $info.removeClass('active');\r\n  }\r\n\r\n  function showInfo() {\r\n    return $info.addClass('active');\r\n  }\r\n\r\n  function currentForm() {\r\n    return this.pathname === window.location.pathname; // jshint ignore:line\r\n  }\r\n\r\n  function handlePopstateChanges() {\r\n    $tabs.filter(currentForm).trigger('click', [true]);\r\n  }\r\n\r\n  function matchActionAttrTo(path) {\r\n    return function () {\r\n      return this.getAttribute('action').indexOf(path) !== -1;\r\n    };\r\n  }\r\n\r\n  function getFormData($form) {\r\n    return $form.serializeArray().reduce(function (obj, item) {\r\n      var name = item.name;\r\n      obj[name] = item.value;\r\n      return obj;\r\n    }, {});\r\n  }\r\n\r\n  var $formcontainer = $('#login-register-page.form-container');\r\n  var $tabs = $('#login-register-page .tab').click(function (event, fromPopstate) {\r\n    var path = event.target.pathname || event.target.parentNode.pathname;\r\n\r\n    // if pushState isn't supported, then follow the link through:\r\n    // Progressive Enhancement FTW.\r\n    if (!pushState && !fromPopstate) {\r\n      return;\r\n    }\r\n\r\n    // do nothing if we're already on this tab\r\n    if (currentPath === path) {\r\n      return false;\r\n    }\r\n\r\n    currentPath = path;\r\n\r\n    $forms\r\n      .hide()\r\n      .filter(matchActionAttrTo(path)) // One element now â†“\r\n      .show();\r\n\r\n    if (!firstrun) {\r\n      hideInfo();\r\n    } else {\r\n      firstrun = false;\r\n    }\r\n\r\n    // fromPopstate is true when we call click in handlePopstateChanges\r\n    // If a user navigated back, to register, it would then set pushState\r\n    // to register, leaving teh user stuck on that page.\r\n    if (!fromPopstate && pushState) {\r\n      pushState(path);\r\n    }\r\n\r\n    event.preventDefault();\r\n\r\n    $formcontainer\r\n      .removeClass('register login')\r\n      .addClass(path.slice(1));\r\n  });\r\n  // Kick it all off with initial event handlers\r\n\r\n  window.addEventListener('popstate', handlePopstateChanges);\r\n  handlePopstateChanges();\r\n\r\n  $forms.on('submit', function(event) {\r\n    event.preventDefault();\r\n    var $form = $(event.target);\r\n\r\n    var data = getFormData($form);\r\n\r\n    $.ajax({\r\n      url: $form.attr('action'),\r\n      type: $form.attr('method'),\r\n      data: data,\r\n      dataType: 'json',\r\n      success: function(res) {\r\n        window.location.href = res.referrer;\r\n      },\r\n      error: function(res) {\r\n        showInfo().find('p').html(res.responseJSON.message);\r\n      }\r\n    });\r\n\r\n  });\r\n\r\n  var $loginForm = $('#login');\r\n  $('#lostpass').click(function (event) {\r\n    event.preventDefault();\r\n\r\n    showInfo().find('p').text('Requesting password reset token...');\r\n\r\n    setTimeout(function () {\r\n      var email = $('#login-username').val();\r\n\r\n      if (email) {\r\n        var data = getFormData($loginForm);\r\n        data.email = data.username;\r\n        $.ajax({\r\n          url: window.location.origin + '/forgot',\r\n          type: 'post',\r\n          data: data,\r\n          dataType: 'json',\r\n          success: function (data) {\r\n            showInfo().find('p').text(data.message || data.error);\r\n          },\r\n          error: function (res) {\r\n            var data = res.responseJSON;\r\n            showInfo().find('p').text(data.error || data.message);\r\n          }\r\n        });\r\n      } else {\r\n        showInfo().find('p').text('Please enter your username or email address below, and I\\'ll try to find you and send you a reset token.');\r\n      }\r\n\r\n    }, 1000);\r\n\r\n    return false;\r\n  });\r\n\r\n});\r\n"]}