{"version":3,"sources":["chrome/keys.js"],"names":["define","$","jsbin","user","name","keys","find","url","getURL","withRevision","withoutRoot","c","window","e","$document","on","s","state","revsion","checksum","d","Date","getTime","localStorage","JSON","stringify","addEventListener","event","key","init","parse"],"mappings":";;;;;;;AAAAA,QACE,iBACC,YACD,SAAUC,EAAEC,GAGZ,aAGA,IAAIA,EAAMC,OAAQD,EAAMC,KAAKC,KAA7B,CAIA,IAAIC,KAEAC,EAAO,SAAUC,GAEnB,OADUF,EAAKE,GAAOL,EAAMM,QAASC,cAAc,EAAMC,aAAa,UAC3DC,GAGb,IACM,iBAAkBC,QAAUA,OAAqB,aAGrD,MAAMC,GACN,OAAOP,EAqBT,OAdAJ,EAAMY,UAAUC,GAAG,QAAS,WAC1BV,EAAKH,EAAMM,QAASC,cAAc,EAAOC,aAAa,MAAaM,EAAGd,EAAMe,MAAMC,QAASP,EAAGT,EAAMe,MAAME,SAAUC,GAAG,IAAKC,MAAQC,WACpIC,aAAalB,KAAOmB,KAAKC,UAAUpB,KAIrCO,OAAOc,iBAAiB,UAAW,SAAUC,GACzB,SAAdA,EAAMC,KACRC,MAIJA,IAEO3B,EAAMG,KAAOC,EAlBpB,SAASuB,IACPxB,EAAOmB,KAAKM,MAAMP,aAAalB,MAAQ","file":"../../chrome/keys.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\"\r\n],function ($,jsbin) {\r\n  /*global jsbin*/\r\n  /*global $document*/\r\n  'use strict';\r\n\r\n  // don't store the keys if they're logged in, since we have this on the server\r\n  if (jsbin.user && jsbin.user.name) {\r\n    return;\r\n  }\r\n\r\n  var keys = {};\r\n\r\n  var find = function (url) {\r\n    var key = keys[url || jsbin.getURL({ withRevision: true, withoutRoot: true })] || {};\r\n    return key.c;\r\n  };\r\n\r\n  try {\r\n    if ('localStorage' in window && window['localStorage'] !== null) { // jshint ignore:line\r\n\r\n    }\r\n  } catch(e){\r\n    return find;\r\n  }\r\n\r\n  function init() {\r\n    keys = JSON.parse(localStorage.keys || '{}');\r\n  }\r\n\r\n  jsbin.$document.on('saved', function () {\r\n    keys[jsbin.getURL({ withRevision: false, withoutRoot: true })] = { s: jsbin.state.revsion, c: jsbin.state.checksum, d: (new Date()).getTime() };\r\n    localStorage.keys = JSON.stringify(keys);\r\n  });\r\n\r\n  // update the key lookup when a new key is stored\r\n  window.addEventListener('storage', function (event) {\r\n    if (event.key === 'keys') {\r\n      init();\r\n    }\r\n  });\r\n\r\n  init();\r\n\r\n  return jsbin.keys = find;\r\n\r\n});"]}