{"version":3,"sources":["chrome/help-search.js"],"names":["define","$","jsbin","results","resultCount","searchTerms","search","position","searchFor","needles","haystack","input","ignore","endingRe","split","RegExp","join","replace","toLowerCase","filter","word","indexOf","trim","e","i","words","lastIndexOf","length","map","sort","matches","data","needle","type","title","slug","category","a","b","html","result","show","s","on","throttle","ajax","url","Date","toString","slice","dataType","cache","success","this","value","bind","children","remove","event","key","which","preventDefault","inc","removeClass","eq","addClass","find","window","open","href"],"mappings":";;;;;;;AAAAA,QACE,iBACC,YACD,SAAUC,EAAEC,GAEV,aACA,IAAIC,EAAUF,EAAE,YACZG,EAAcH,EAAE,iBAChBI,KACAC,EAASL,EAAE,eACXM,GAAY,EAiGhB,SAASC,EAAUC,EAASC,GA3B5B,IAAiBC,EACXC,EAGAC,EAJWF,EA6BGF,EA5BdG,EAAS,mGAAmGE,MAAM,KAGlHD,EAAW,IAAIE,OAAO,IADZ,gBAC0BD,MAAM,KAAKE,KAAK,KAAO,MAyB/DP,GAvBQE,GAAO,IAEZM,QAAQ,gBAAgB,IAExBA,QAAQ,MAAO,KAAKA,QAAQ,WAAY,IAExCC,cAAcJ,MAAM,KAEpBK,OAAO,SAAUC,GAChB,OAAwC,IAAjCR,EAAOS,QAAQD,EAAKE,UAC1BH,OAAO,SAAUI,EAAGC,EAAGC,GAExB,OAAOA,EAAMC,YAAYH,KAAOC,IAC/BL,OAAO,SAAUC,GAElB,OAAOA,EAAKO,OAAS,IACpBC,IAAI,SAAUR,GACf,OAAOA,EAAKE,OAAOL,QAAQJ,EAAU,MACpCgB,OAML,IAAIC,EAAUpB,EAASkB,IAAI,SAAUG,GACnC,IAAID,EAAUrB,EAAQU,OAAO,SAAUa,GACrC,OAAuC,IAAhCD,EAAKN,MAAMJ,QAAQW,KACzBL,OAEH,OACEM,KAAMF,EAAKE,KACXC,MAAOH,EAAKG,MACZC,KAAMJ,EAAKI,KACXC,SAAUL,EAAKK,SACfN,QAASA,KAEVX,OAAO,SAAUY,GAClB,OAAOA,EAAKD,QAAU,IACrBD,KAAK,SAAUQ,EAAGC,GACnB,OAAOA,EAAER,QAAUO,EAAEP,UAGvB3B,EAAQoC,KAAKT,EAAQF,IAAI,SAAUY,GACjC,MAAO,4CAA8CA,EAAOL,KAAO,KAAOK,EAAON,OAAyB,SAAhBM,EAAOP,KAAkB,UAAY,IAAM,SACpIjB,KAAK,OAERb,EAAQsC,OACR,IAAIC,EAAI,GACe,IAAnBZ,EAAQH,SACVe,EAAI,KAENtC,EAAYmC,KAAKT,EAAQH,OAAS,UAAYe,GA7HhDpC,EAAOqC,GAAG,QAASzC,EAAM0C,SAAS,WACL,IAAvBvC,EAAYsB,OACd1B,EAAE4C,MACAC,IAAK,sBAAuB,IAAKC,MAAQC,WAAWlC,MAAM,KAAKmC,MAAM,EAAG,GAAGjC,KAAK,KAChFkC,SAAU,OACVC,OAAO,EACPC,QAAS,SAAUrB,GACjB1B,EAAc0B,EACdvB,EAAU6C,KAAKC,MAAOjD,IACtBkD,KAAKF,QAGT7C,EAAU6C,KAAKC,MAAOjD,GAExBE,GAAY,GACX,MAUHJ,EAAQwC,GAAG,YAAa,YACJ,IAAdpC,IACFJ,EAAQqD,WAAWC,OAAO,aAC1BlD,GAAY,KAIhBD,EAAOqC,GAAG,UAAW,SAAUe,GAC7B,IAAIC,EAAMD,EAAME,MAChB,GAAY,KAARD,GAAsB,KAARA,EAAY,CAC5BD,EAAMG,iBACN,IAAIC,EAAM,EACE,KAARH,IACFG,GAAO,GAGTvD,GAAYuD,EAEZ,IAAIN,EAAWrD,EAAQqD,WAEnB7B,EAAS6B,EAAS7B,OACtB6B,EAASO,YAAY,SAEjBxD,EAAW,EACbA,EAAWoB,EAAS,EACXpB,EAAWoB,EAAS,IAC7BpB,EAAW,GAGbiD,EAASQ,GAAGzD,GAAU0D,SAAS,cAC1B,GAAY,KAARN,EAAY,CACrB,IAAIb,EAAM3C,EAAQ+D,KAAK,UAAU,GAC7BpB,GACFqB,OAAOC,KAAKtB,EAAIuB","file":"../../chrome/help-search.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\"\r\n],function ($,jsbin) {\r\n\r\n    'use strict';\r\n    var results = $('#results');\r\n    var resultCount = $('#result-count');\r\n    var searchTerms = [];\r\n    var search = $('#helpsearch');\r\n    var position = -1;\r\n\r\n    search.on('input', jsbin.throttle(function () {\r\n      if (searchTerms.length === 0) {\r\n        $.ajax({\r\n          url: '/help/search.json?' + (new Date()).toString().split(' ').slice(0, 4).join('-'),\r\n          dataType: 'json',\r\n          cache: true,\r\n          success: function (data) {\r\n            searchTerms = data;\r\n            searchFor(this.value, searchTerms);\r\n          }.bind(this)\r\n        });\r\n      } else {\r\n        searchFor(this.value, searchTerms);\r\n      }\r\n      position = -1;\r\n    }, 200));\r\n\r\n    // document.documentElement.addEventListener('click', function (event) {\r\n    //   if (event.target.id === 'search' || event.target.id === 'results') {\r\n\r\n    //   } else {\r\n    //     resultsEl.hidden = true;\r\n    //   }\r\n    // });\r\n\r\n    results.on('mousemove', function () {\r\n      if (position !== -1) {\r\n        results.children().remove('highlight');\r\n        position = -1;\r\n      }\r\n    });\r\n\r\n    search.on('keydown', function (event) {\r\n      var key = event.which;\r\n      if (key === 38 || key === 40) { // up / down\r\n        event.preventDefault();\r\n        var inc = 1;\r\n        if (key === 38) {\r\n          inc = -1;\r\n        }\r\n\r\n        position += inc;\r\n\r\n        var children = results.children();\r\n\r\n        var length = children.length;\r\n        children.removeClass('hover');\r\n\r\n        if (position < 0) {\r\n          position = length - 1;\r\n        } else if (position > length - 1) {\r\n          position = 0;\r\n        }\r\n\r\n        children.eq(position).addClass('hover');\r\n      } else if (key === 13) { // select\r\n        var url = results.find('.hover')[0];\r\n        if (url) {\r\n          window.open(url.href);\r\n          // window.location = url.href;\r\n        }\r\n      }\r\n    });\r\n\r\n    // search.on('focus', function () {\r\n    //   results.hide();\r\n    // });\r\n\r\n    function wordmap(input) {\r\n      var ignore = \"a an and on in it of if for the i is i'm i'd it's or to me be not was do so at are what bin bins\".split(' ');\r\n\r\n      var endings = 'ing ly lies s';\r\n      var endingRe = new RegExp('(' + endings.split(' ').join('|') + ')$');\r\n\r\n      return (input||'')\r\n        //- strip html\r\n        .replace(/(<([^>]+)>)/ig,'')\r\n        //- strip non-letters\r\n        .replace(/\\W/g, ' ').replace(/[\"'\\.,]/g, '')\r\n        //- turn in to array of lower case words\r\n        .toLowerCase().split(' ')\r\n        //- filter out ignored words\r\n        .filter(function (word) {\r\n          return ignore.indexOf(word.trim()) === -1;\r\n        }).filter(function (e, i, words) {\r\n          //- return unique\r\n          return words.lastIndexOf(e) === i;\r\n        }).filter(function (word) {\r\n          //- return words 3 chars or longer\r\n          return word.length > 2;\r\n        }).map(function (word) {\r\n          return word.trim().replace(endingRe, '');\r\n        }).sort();\r\n    }\r\n\r\n    function searchFor(needles, haystack) {\r\n      'use strict';\r\n      needles = wordmap(needles);\r\n      var matches = haystack.map(function (data) {\r\n        var matches = needles.filter(function (needle) {\r\n          return data.words.indexOf(needle) !== -1;\r\n        }).length;\r\n\r\n        return {\r\n          type: data.type,\r\n          title: data.title,\r\n          slug: data.slug,\r\n          category: data.category,\r\n          matches: matches\r\n        };\r\n      }).filter(function (data) {\r\n        return data.matches > 0;\r\n      }).sort(function (a, b) {\r\n        return b.matches - a.matches;\r\n      });\r\n\r\n      results.html(matches.map(function (result) {\r\n        return '<a target=\"_blank\" class=\"button\" href=\"/' + result.slug + '\">' + result.title + (result.type === 'blog' ? ' (blog)' : '') + '</a>';\r\n      }).join('\\n'));\r\n\r\n      results.show();\r\n      var s = '';\r\n      if (matches.length !== 1) {\r\n        s = 's';\r\n      }\r\n      resultCount.html(matches.length + ' result' + s);\r\n    }\r\n\r\n\r\n});\r\n"]}