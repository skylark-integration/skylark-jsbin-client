{"version":3,"sources":["chrome/welcome-panel.js"],"names":["define","$","jsbin","analytics","length","undefined","settings","gui","toppanel","store","localStorage","setItem","JSON","stringify","$body","hasClass","addClass","removeClass","welcomePanelState","goSlow","e","shiftKey","on","$document","trigger","click","event","preventDefault","save","ajax","url","Date","toString","split","slice","join","dataType","cache","success","data","blogpost","blog","root","replace","html","slug","title","last","count","getItem","timestamp","reduce","prev","current","attr","lastpost","help","array","t","i","m","Math","floor","random","shuffle","find","mousedown","welcomePanelLink","this","href"],"mappings":";;;;;;;AAAAA,QACE,iBACC,WACA,eACD,SAAUC,EAAEC,EAAMC,GAEhB,aAEA,GAAKF,EAAE,aAAaG,OAApB,MAI2BC,IAAvBH,EAAMI,SAASC,MACjBL,EAAMI,SAASC,aAEmBF,IAAhCH,EAAMI,SAASC,IAAIC,WACrBN,EAAMI,SAASC,IAAIC,UAAW,EAC9BC,MAAMC,aAAaC,QAAQ,WAAYC,KAAKC,UAAUX,EAAMI,YAG1DQ,MAAMC,SAAS,cAA+C,IAAhCb,EAAMI,SAASC,IAAIC,WACnDM,MAAME,SAAS,kBACfF,MAAMG,YAAY,aAIpBd,EAAUe,kBAAkBhB,EAAMI,SAASC,IAAIC,UAE/C,IAgBIW,EAAS,SAASC,GACpBN,MAAMG,YAAY,iBACdG,EAAEC,UACJP,MAAME,SAAS,kBAInBf,EAAE,kBAAkBqB,GAAG,kFAAmF,SAASF,GACjHG,UAAUC,QAAQ,iBAGpBvB,EAAE,kBAAkBwB,MAAM,SAASC,GACjCA,EAAMC,iBACNR,EAAOO,GA5BPxB,EAAMI,SAASC,IAAIC,UAAW,EAC9BF,SAASsB,OACTd,MAAME,SAAS,kBACfF,MAAMG,YAAY,cA4BpBhB,EAAE,kBAAkBwB,MAAM,SAASC,GACjCA,EAAMC,iBACNR,EAAOO,GAxBPxB,EAAMI,SAASC,IAAIC,UAAW,EAC9BF,SAASsB,OACTd,MAAMG,YAAY,kBAClBH,MAAME,SAAS,cAkDjBf,EAAE4B,MAEAC,IAAK,mBAAoB,IAAKC,MAAQC,WAAWC,MAAM,KAAKC,MAAM,EAAG,GAAGC,KAAK,KAC7EC,SAAU,OACVC,OAAO,EACPC,QAAS,SAAUC,GACjB,IAAIC,EAAWD,EAAKE,KAAK,GAGrBC,EAAOxC,EAAMwC,KAAKC,QAAQ,SAAU,QACxC1C,EAAE,qBAAqB2C,KAAK,gBAAkBF,EAAO,IAAMF,EAASK,KAAO,2CAA6CL,EAASM,MAAMH,QAAQ,aAAc,IAAM,aAEnK,IAAII,EAAO,KACPC,EAAQ,EACZ,IACED,EAAOtC,MAAMC,aAAauC,QAAQ,aAAe,KACjD,MAAO7B,IAEI,OAAT2B,IAGAC,GAFFD,GAAQ,GACGP,EAASU,UACVX,EAAKE,KAAKU,OAAO,SAAUC,EAAMC,GACvC,OAAIN,EAAOM,EAAQH,UACVE,EAAO,EAETA,GACN,GAEK,GAIRJ,GACF/C,EAAE,WAAWqD,KAAK,OAAQZ,EAAO,IAAMH,EAAKE,KAAKO,EAAM,GAAGH,MAAMS,KAAK,aAAcN,GAAO1B,GAAG,QAAS,WAKpG,IACEZ,aAAa6C,SAAWhB,EAAKE,KAAKO,EAAM,GAAGE,UAC3C,MAAO9B,OAIb,IAAIoC,EA9DR,SAAiBC,GAIf,IAHA,IAAsBC,EAAGC,EAArBC,EAAIH,EAAMrD,OAGPwD,GAGLD,EAAIE,KAAKC,MAAMD,KAAKE,SAAWH,KAG/BF,EAAID,EAAMG,GACVH,EAAMG,GAAKH,EAAME,GACjBF,EAAME,GAAKD,EAGb,OAAOD,EA+CMO,CAAQzB,EAAKiB,MAExBvD,EAAE,qBAAqB2C,KAAK,gBAAkBF,EAAO,IAAMc,EAAK,GAAGX,KAAO,2CAA6CW,EAAK,GAAGV,MAAQ,yBAA2BJ,EAAO,IAAMc,EAAK,GAAGX,KAAO,2CAA6CW,EAAK,GAAGV,MAAQ,gBAM/P7C,EAAE,aAAagE,KAAK,kBAAkBC,UAAU,WAC9C/D,EAAUgE,iBAAiBC,KAAKC","file":"../../chrome/welcome-panel.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"./analytics\"\r\n],function ($,jsbin,analytics) {\r\n    /*global jsbin, $, $body, $document, analytics, settings*/\r\n    'use strict';\r\n\r\n    if (!$('#toppanel').length) {\r\n      return;\r\n    }\r\n\r\n    if (jsbin.settings.gui === undefined) {\r\n      jsbin.settings.gui = {};\r\n    }\r\n    if (jsbin.settings.gui.toppanel === undefined) {\r\n      jsbin.settings.gui.toppanel = true;\r\n      store.localStorage.setItem('settings', JSON.stringify(jsbin.settings));\r\n    }\r\n\r\n    if ($body.hasClass('toppanel') && jsbin.settings.gui.toppanel === false) {\r\n      $body.addClass('toppanel-close');\r\n      $body.removeClass('toppanel');\r\n    }\r\n\r\n    // analytics for panel state\r\n    analytics.welcomePanelState(jsbin.settings.gui.toppanel);\r\n\r\n    var removeToppanel = function() {\r\n      jsbin.settings.gui.toppanel = false;\r\n      settings.save();\r\n      $body.addClass('toppanel-close');\r\n      $body.removeClass('toppanel');\r\n\r\n      // $document.trigger('sizeeditors');\r\n    };\r\n\r\n    var showToppanel = function() {\r\n      jsbin.settings.gui.toppanel = true;\r\n      settings.save();\r\n      $body.removeClass('toppanel-close');\r\n      $body.addClass('toppanel');\r\n    };\r\n\r\n    var goSlow = function(e) {\r\n      $body.removeClass('toppanel-slow');\r\n      if (e.shiftKey) {\r\n        $body.addClass('toppanel-slow');\r\n      }\r\n    };\r\n\r\n    $('.toppanel-logo').on('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {\r\n      $document.trigger('sizeeditors');\r\n    });\r\n\r\n    $('.toppanel-hide').click(function(event) {\r\n      event.preventDefault();\r\n      goSlow(event);\r\n      removeToppanel();\r\n    });\r\n    $('.toppanel-logo').click(function(event) {\r\n      event.preventDefault();\r\n      goSlow(event);\r\n      showToppanel();\r\n    });\r\n    // $document.keydown(function (event) {\r\n    //   if (event.which === 27) {\r\n    //     if ($body.hasClass('toppanel')) {\r\n    //       removeToppanel();\r\n    //     }\r\n    //   }\r\n    // });\r\n\r\n    function shuffle(array) {\r\n      var m = array.length, t, i;\r\n\r\n      // While there remain elements to shuffle...\r\n      while (m) {\r\n\r\n        // Pick a remaining element...\r\n        i = Math.floor(Math.random() * m--);\r\n\r\n        // And swap it with the current element.\r\n        t = array[m];\r\n        array[m] = array[i];\r\n        array[i] = t;\r\n      }\r\n\r\n      return array;\r\n    }\r\n\r\n    $.ajax({\r\n      // tries to cache once a day\r\n      url: '/blog/all.json?' + (new Date()).toString().split(' ').slice(0, 4).join('-'),\r\n      dataType: 'json',\r\n      cache: true,\r\n      success: function (data) {\r\n        var blogpost = data.blog[0];\r\n        // this is daft, but it means that the landing page is the same\r\n        // for all, and ensures that blog comments end up on a single place\r\n        var root = jsbin.root.replace(/^https/, 'http');\r\n        $('.toppanel-blog ul').html('<li><a href=\"' + root + '/' + blogpost.slug + '\" target=\"_blank\" class=\"toppanel-link\">' + blogpost.title.replace(/TWDTW.*:\\s/, '') + '</a></li>');\r\n\r\n        var last = null;\r\n        var count = 1;\r\n        try {\r\n          last = store.localStorage.getItem('lastpost') || null;\r\n        } catch (e) {}\r\n\r\n        if (last !== null) {\r\n          last *= 1;\r\n          if (last < blogpost.timestamp) {\r\n            count = data.blog.reduce(function (prev, current) {\r\n              if (last < current.timestamp) {\r\n                return prev + 1;\r\n              }\r\n              return prev;\r\n            }, 0);\r\n          } else {\r\n            count = 0;\r\n          }\r\n        }\r\n\r\n        if (count) {\r\n          $('.blog a').attr('href', root + '/' + data.blog[count-1].slug).attr('data-count', count).on('click', function () {\r\n            // this is a weird hack work around to try to clear the storage\r\n            // item that says which was the last post viewed. so we update\r\n            // the timestamp when the user clicks the link, because we know\r\n            // they'll land on the latest post\r\n            try {\r\n              localStorage.lastpost = data.blog[count-1].timestamp;\r\n            } catch (e) {}\r\n          });\r\n        }\r\n\r\n        var help = shuffle(data.help);\r\n\r\n        $('.toppanel-help ul').html('<li><a href=\"' + root + '/' + help[0].slug + '\" target=\"_blank\" class=\"toppanel-link\">' + help[0].title + '</a></li><li><a href=\"' + root + '/' + help[1].slug + '\" target=\"_blank\" class=\"toppanel-link\">' + help[1].title + '</a></li>');\r\n\r\n      }\r\n    })\r\n\r\n    // analytics for links\r\n    $('#toppanel').find('.toppanel-link').mousedown(function() {\r\n      analytics.welcomePanelLink(this.href);\r\n    });\r\n\r\n });"]}