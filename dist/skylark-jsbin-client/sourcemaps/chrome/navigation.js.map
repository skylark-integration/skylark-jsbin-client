{"version":3,"sources":["chrome/navigation.js"],"names":["define","$","store","hideOpen","panels","jsbin","analytics","archive","click","event","preventDefault","localStorage","saveTemplate","setItem","named","javascript","getCode","html","css","JSON","stringify","processor","id","$document","trigger","type","content","autohide","on","stopImmediatePropagation","login","this","toggleClass","hash","submit","i","sessionStorage","length","key","indexOf","removeItem","data","openFromAvatar","closest","removeClass","open","hideAll","$lockrevision","saveChecksum","lock","addClass","$panelCheckboxes","updateSavedState","bind","attr","getVisible","forEach","panel","filter","prop","change","e","setTimeout","live","hide","run","console","visible","render","renderLivePreview","runconsole","jsconsole","clear","$body","keyboardHelpVisible","is","mobile","sideNavVisible","urlHelpVisible","dblclick","allEditors","lineNumbers","editor","getOption","setOption","settings","createNew","savecontent","saveOnExit","restore","show","window","location","root","$privateButton","$publicButton","$visibilityButtons","visibility","ajax","url","getURL","withRevision","success","find","empty","focus","includejs","undefined","embed","getItem","checked","enableLiveJS","hideheader","cancelUp","select","mouseup","mousedown","ismac","navigator","userAgent","mackeys","each","$this","shortcut","replace","toUpperCase","append","re","head","meta","metaContent","metatag","cm","test","setCode","cursor","getSearchCursor","findNext","contentCursor","from","line","pos","ch","to","setCursor","setSelection","mark","markText","className","publishVanity","href","shareRoot","error","xhr","githubIssue","user","state","metadata","name","confirm","deleteAll","deleted","status","checksum","$enableUniversalEditor","simple","universalEditor","save","reload","first","shift"],"mappings":"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","file":"../../chrome/navigation.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"skylark-jsbin-base/storage\",\r\n  \"skylark-jsbin-chrome/hideOpen\",\r\n  \"skylark-jsbin-coder/editors/panels\",\r\n   \"../jsbin\",\r\n   \"./analytics\",\r\n   \"./archive\"\r\n],function ($,store,hideOpen, panels,jsbin,analytics, archive) {\r\n  var $startingpoint = $('a.startingpoint').click(function (event) {\r\n    event.preventDefault();\r\n    if (localStorage) {\r\n      analytics.saveTemplate();\r\n      localStorage.setItem('saved-javascript', panels.named.javascript.getCode());\r\n      localStorage.setItem('saved-html', panels.named.html.getCode());\r\n      localStorage.setItem('saved-css', panels.named.css.getCode());\r\n\r\n      localStorage.setItem('saved-processors', JSON.stringify({\r\n        javascript: panels.named.javascript.processor.id,\r\n        html: panels.named.html.processor.id,\r\n        css: panels.named.css.processor.id,\r\n      }));\r\n\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'notification',\r\n        content: 'Starting template updated and saved',\r\n        autohide: 3000\r\n      });\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'Saving templates isn\\'t supported in this browser I\\'m afraid. Sorry'\r\n      });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // if (localStorage && localStorage['saved-html']) {\r\n    // $startingpoint.append('')\r\n  // }\r\n\r\n  $('a.disabled').on('click mousedown mouseup', function (event) {\r\n    event.stopImmediatePropagation();\r\n    return false;\r\n  });\r\n\r\n  $('#loginbtn').click(function () {\r\n    analytics.login();\r\n    $(this).toggleClass('open');\r\n    // $('#login').show();\r\n    // loginVisible = true;\r\n    // return false;\r\n  });\r\n\r\n  $('a.logout').click(function (event) {\r\n    event.preventDefault();\r\n\r\n    // We submit a form here because I can't work out how to style the button\r\n    // element in the form to look the same as the anchor. Ideally we would\r\n    // remove that and just let the form submit itself...\r\n    $(this.hash).submit();\r\n    // Clear session storage so private bins wont be cached.\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n  });\r\n\r\n  $('.homebtn').click(function (event, data) {\r\n    if (this.id === 'avatar') {\r\n      analytics.openFromAvatar();\r\n    } else if (this.id === 'profile') {\r\n      analytics.openFromAvatar();\r\n      $(this).closest('.open').removeClass('open');\r\n    } else {\r\n      analytics.open(data);\r\n    }\r\n\r\n    hideOpen();\r\n\r\n    panels.hideAll();\r\n    return false;\r\n  });\r\n\r\n  var $lockrevision = $('div.lockrevision').on('click', function (event) {\r\n    event.preventDefault();\r\n    jsbin.saveChecksum = false;\r\n    jsbin.$document.trigger('locked');\r\n  }).on('mouseup', function () {\r\n    return false;\r\n  });\r\n\r\n  jsbin.$document.on('locked', function () {\r\n    if (!$lockrevision.data('locked')) {\r\n      analytics.lock();\r\n      $lockrevision.removeClass('icon-unlocked').addClass('icon-lock');\r\n      $lockrevision.html('<span>This bin is now locked from further changes</span>');\r\n      $lockrevision.data('locked', true);\r\n    }\r\n  });\r\n\r\n  // var $lockrevision = $('.lockrevision').on('click', function (event) {\r\n  // });\r\n\r\n  jsbin.$document.on('saved', function () {\r\n    $lockrevision.removeClass('icon-lock').addClass('icon-unlocked').data('locked', false);\r\n    $lockrevision.html('<span>Click to lock and prevent further changes</span>');\r\n  });\r\n\r\n  // TODO decide whether to remove this, since it definitely doesn't work!\r\n  // $('#share input[type=text], #share textarea').on('beforecopy', function (event) {\r\n  //   console.log(this, this.getAttribute('data-path'));\r\n  //   analytics.share('copy', this.getAttribute('data-path').substring(1) || 'output');\r\n  // });\r\n\r\n  if (!$('#sharemenu .share-split').length) {\r\n    var $panelCheckboxes = $('#sharepanels input[type=\"checkbox\"]').on('change', function () {\r\n      updateSavedState();\r\n    });\r\n    $('#sharemenu').bind('open', function () {\r\n      $panelCheckboxes.attr('checked', false);\r\n      panels.getVisible().forEach(function (panel) {\r\n        $panelCheckboxes.filter('[data-panel=\"' + panel.id + '\"]').prop('checked', true).change();\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n\r\n  $('#jsbinurl').click(function (e) {\r\n    setTimeout(function () {\r\n      panels.named.live.hide();\r\n    }, 0);\r\n  });\r\n\r\n  $('#runwithalerts, li.run-with-js a').click(function (event, data) {\r\n    analytics.run(data);\r\n    if (panels.named.console.visible) {\r\n      panels.named.console.render(true);\r\n    } else {\r\n      renderLivePreview(true);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#runconsole').click(function () {\r\n    analytics.runconsole();\r\n    panels.named.console.render(true);\r\n    return false;\r\n  });\r\n\r\n  $('#clearconsole').click(function () {\r\n    jsconsole.clear();\r\n    return false;\r\n  });\r\n\r\n  $('#showhelp').click(function () {\r\n    $body.toggleClass('keyboardHelp');\r\n    keyboardHelpVisible = $body.is('.keyboardHelp');\r\n    if (keyboardHelpVisible) {\r\n      // analytics.help('keyboard');\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('a.toggle-side-nav').on(jsbin.mobile ? 'touchstart' : 'click', function () {\r\n    $body.toggleClass('show-nav');\r\n    sideNavVisible = $body.is('.show-nav');\r\n    if (!sideNavVisible && !jsbin.mobile) {\r\n      // we only focus the editor in desktop, otherwise the keyboard jumps up\r\n      $('#skipToEditor').click();\r\n    }\r\n    return sideNavVisible;\r\n  });\r\n\r\n\r\n  $('#showurls').click(function () {\r\n    $body.toggleClass('urlHelp');\r\n    urlHelpVisible = $body.is('.urlHelp');\r\n    if (urlHelpVisible) {\r\n      // analytics.urls();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('.code.panel > .label > span.name').dblclick(function () {\r\n    panels.allEditors(function (panel) {\r\n      var lineNumbers = !panel.editor.getOption('lineNumbers');\r\n      panel.editor.setOption('lineNumbers', lineNumbers);\r\n      jsbin.settings.editor.lineNumbers = lineNumbers;\r\n    });\r\n  });\r\n\r\n  $('a.createnew').click(function (event) {\r\n    event.preventDefault();\r\n    var i, key;\r\n    analytics.createNew();\r\n    // FIXME this is out and out [cr]lazy....\r\n    panels.savecontent = function(){};\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n\r\n    // clear out the write checksum too\r\n    store.sessionStorage.removeItem('checksum');\r\n\r\n    panels.saveOnExit = false;\r\n\r\n    // first try to restore their default panels\r\n    panels.restore();\r\n\r\n    // if nothing was shown, show html & live\r\n    setTimeout(function () {\r\n      if (panels.getVisible().length === 0) {\r\n        panels.named.html.show();\r\n        panels.named.live.show();\r\n      }\r\n      window.location = jsbin.root;\r\n    }, 0);\r\n  });\r\n\r\n  var $privateButton = $('#control a.visibilityToggle#private');\r\n  var $publicButton = $('#control a.visibilityToggle#public');\r\n\r\n  var $visibilityButtons = $('#control a.visibilityToggle').click(function(event) {\r\n    event.preventDefault();\r\n\r\n    var visibility = $(this).data('vis');\r\n\r\n    $.ajax({\r\n      url: jsbin.getURL({ withRevision: true }) + '/' + visibility,\r\n      type: 'post',\r\n      success: function (data) {\r\n\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now ' + visibility,\r\n          autohide: 6000\r\n        });\r\n\r\n        $visibilityButtons.css('display', 'none');\r\n\r\n        if (visibility === 'public') {\r\n          $privateButton.css('display', 'block');\r\n        } else {\r\n          $publicButton.css('display', 'block');\r\n        }\r\n\r\n      }\r\n    });\r\n  });\r\n\r\n  $('form.login').closest('.menu').bind('close', function () {\r\n    $(this).find('.loginFeedback').empty().hide();\r\n    $('#login').removeClass('forgot');\r\n  });\r\n\r\n  $('#lostpass').click(function (e) {\r\n    $('#login').addClass('forgot').find('input[name=email]').focus();\r\n    return false;\r\n  });\r\n\r\n  jsbin.settings.includejs = jsbin.settings.includejs === undefined ? true : jsbin.settings.includejs;\r\n\r\n  // ignore for embed as there might be a lot of embeds on the page\r\n  if (!jsbin.embed && store.sessionStorage.getItem('runnerPending')) {\r\n    jsbin.$document.trigger('tip', {\r\n      content: 'It looks like your last session may have crashed, so I\\'ve disabled \"Auto-run JS\" for you',\r\n      type: 'error',\r\n    });\r\n    store.sessionStorage.removeItem('runnerPending');\r\n    jsbin.settings.includejs = false;\r\n  }\r\n\r\n  $('#enablejs').change(function () {\r\n    jsbin.settings.includejs = this.checked;\r\n    analytics.enableLiveJS(jsbin.settings.includejs);\r\n    panels.named.live.render();\r\n  }).attr('checked', jsbin.settings.includejs);\r\n\r\n  if (!jsbin.embed && jsbin.settings.hideheader) {\r\n    jsbin.$body.addClass('hideheader');\r\n  }\r\n\r\n  var cancelUp = false;\r\n  $('form input, form textarea').focus(function () {\r\n    this.select();\r\n    cancelUp = true;\r\n  }).mouseup(function () {\r\n    if (cancelUp) {\r\n      cancelUp = false;\r\n      return false;\r\n    }\r\n  });\r\n\r\n  if (window.location.hash) {\r\n    $('a[href$=\"' + window.location.hash + '\"]').mousedown();\r\n  }\r\n\r\n  var ismac = navigator.userAgent.indexOf(' Mac ') !== -1,\r\n      mackeys = {\r\n        'ctrl': '⌘',\r\n        'shift': '⇧',\r\n        'del': '⌫'\r\n      };\r\n\r\n  $('#control').find('a[data-shortcut]').each(function () {\r\n    var $this = $(this),\r\n        data = $this.data();\r\n\r\n    var key = data.shortcut;\r\n    if (ismac) {\r\n      key = key.replace(/ctrl/i, mackeys.ctrl).replace(/shift/, mackeys.shift).replace(/del/, mackeys.del).replace(/\\+/g, '').toUpperCase();\r\n    }\r\n\r\n    $this.append('<span class=\"keyshortcut\">' + key + '</span>');\r\n  });\r\n\r\n  (function () {\r\n\r\n  var re = {\r\n    head: /<head(.*)\\n/i,\r\n    meta: /<meta name=\"description\".*?>/i,\r\n    metaContent: /content=\".*?\"/i\r\n  };\r\n\r\n  var metatag = '<meta name=\"description\" content=\"[add your bin description]\">\\n';\r\n\r\n  $('#addmeta').click(function () {\r\n    // if not - insert\r\n    // <meta name=\"description\" content=\"\" />\r\n    // if meta description is in the HTML, highlight it\r\n    var editor = panels.named.html,\r\n        cm = editor.editor,\r\n        html = editor.getCode();\r\n\r\n    if (!editor.visible) {\r\n      editor.show();\r\n    }\r\n\r\n    if (!re.meta.test(html)) {\r\n      if (re.head.test(html)) {\r\n        html = html.replace(re.head, '<head$1\\n' + metatag);\r\n      } else {\r\n        // slap in the top\r\n        html = metatag + html;\r\n      }\r\n    }\r\n\r\n    editor.setCode(html);\r\n\r\n    // now select the text\r\n    // editor.editor is the CM object...yeah, sorry about that...\r\n    var cursor = cm.getSearchCursor(re.meta);\r\n    cursor.findNext();\r\n\r\n    var contentCursor = cm.getSearchCursor(re.metaContent);\r\n    contentCursor.findNext();\r\n\r\n    var from = { line: cursor.pos.from.line, ch: cursor.pos.from.ch + '<meta name=\"description\" content=\"'.length },\r\n        to = { line: contentCursor.pos.to.line, ch: contentCursor.pos.to.ch - 1 };\r\n\r\n    cm.setCursor(from);\r\n    cm.setSelection(from, to);\r\n    cm.on('cursoractivity', function () {\r\n      cm.on('cursoractivity', null);\r\n      mark.clear();\r\n    });\r\n\r\n    var mark = cm.markText(from, to, { className: 'highlight' });\r\n\r\n    cm.focus();\r\n\r\n    return false;\r\n  });\r\n\r\n  $('a.publish-to-vanity').on('click', function (event) {\r\n    event.preventDefault();\r\n    analytics.publishVanity();\r\n\r\n    $.ajax({\r\n      type: 'post',\r\n      url: this.href,\r\n      data: { url: jsbin.getURL({ withRevision: true }) },\r\n      success: function () {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now published to your vanity URL: <a target=\"_blank\" href=\"' + jsbin.shareRoot + '\">' + jsbin.shareRoot + '</a>'\r\n        });\r\n      },\r\n      error: function (xhr) {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'error',\r\n          content: 'There was a problem publishing to your vanity URL. Can you try again or file a <a target=\"_blank\" href=\"' + githubIssue() + '\">new issue</a>?'\r\n        });\r\n      }\r\n    })\r\n  });\r\n\r\n  jsbin.$document.on('click', 'a.deleteallbins', function () {\r\n    if (jsbin.user && jsbin.state.metadata.name === jsbin.user.name) {\r\n      if (confirm('Delete all snapshots of this bin including this one?')) {\r\n      analytics.deleteAll();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL() + '/delete-all',\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin and history is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target=\"_blank\" href=\"/help/delete-a-bin\">Need help?</a>'\r\n      });\r\n    }\r\n  });\r\n\r\n  $('a.deletebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    if (confirm('Delete this bin?')) {\r\n      analytics['delete']();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL({ withRevision: true }) + '/delete',\r\n        data: { checksum: jsbin.state.checksum },\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n  });\r\n\r\n  $('a.archivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive();\r\n  });\r\n\r\n  $('a.unarchivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive(false);\r\n  });\r\n\r\n  var $enableUniversalEditor = $('#enableUniversalEditor').on('change', function (e) {\r\n    e.preventDefault();\r\n\r\n    jsbin.settings.editor.simple = this.checked;\r\n    analytics.universalEditor(jsbin.settings.editor.simple);\r\n    settings.save(function () {\r\n      window.location.reload();\r\n    });\r\n  });\r\n\r\n  if (jsbin.settings.editor.simple) {\r\n    $enableUniversalEditor.prop('checked', true);\r\n  }\r\n\r\n  $('#skipToEditor').on('click keypress', function () {\r\n    var first = (panels.getVisible() || ['html']).shift();\r\n    if (jsbin.settings.editor.simple || jsbin.mobile) {\r\n      $('#' + first.id).focus();\r\n    } else if (first) {\r\n      first.editor.focus();\r\n    } else {\r\n      panels.named.html.editor.focus();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  }());\r\n\r\n});"]}