{"version":3,"sources":["chrome/navigation.js"],"names":["define","$","jsbin","analytics","archive","click","event","preventDefault","localStorage","saveTemplate","setItem","editors","javascript","getCode","html","css","JSON","stringify","panels","named","processor","id","$document","trigger","type","content","autohide","on","stopImmediatePropagation","login","this","toggleClass","hash","submit","i","store","sessionStorage","length","key","indexOf","removeItem","data","openFromAvatar","closest","removeClass","open","hideOpen","hideAll","$lockrevision","saveChecksum","lock","addClass","$panelCheckboxes","updateSavedState","bind","attr","getVisible","forEach","panel","filter","prop","change","dropdownOpen","menuDown","closedropdown","dropdownButtons","f","focused","mobile","focus","editor","mousedown","e","$dropdownLinks","el","nofocus","menu","openMenu","substring","input","find","setTimeout","select","opendropdown","mouseup","closeMenu","ignoreUp","$body","target","fromClick","nodeName","selectMenu","getAttribute","href","hostname","window","location","triggerHandler","mouseover","live","hide","run","console","visible","render","renderLivePreview","runconsole","jsconsole","clear","keyboardHelpVisible","is","sideNavVisible","urlHelpVisible","dblclick","allEditors","lineNumbers","getOption","setOption","settings","createNew","savecontent","saveOnExit","restore","show","root","$privateButton","$publicButton","$visibilityButtons","visibility","ajax","url","getURL","withRevision","success","empty","includejs","undefined","embed","getItem","checked","enableLiveJS","hideheader","cancelUp","ismac","navigator","userAgent","mackeys","each","$this","shortcut","replace","toUpperCase","append","re","head","meta","metaContent","metatag","cm","test","setCode","cursor","getSearchCursor","findNext","contentCursor","from","line","pos","ch","to","setCursor","setSelection","mark","markText","className","publishVanity","shareRoot","error","xhr","githubIssue","user","state","metadata","name","confirm","deleteAll","deleted","status","checksum","$enableUniversalEditor","simple","universalEditor","save","reload","first","shift"],"mappings":"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","file":"../../chrome/navigation.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\",\r\n   \"./analytics\",\r\n   \"./archive\"\r\n],function ($,jsbin,analytics, archive) {\r\n  var $startingpoint = $('a.startingpoint').click(function (event) {\r\n    event.preventDefault();\r\n    if (localStorage) {\r\n      analytics.saveTemplate();\r\n      localStorage.setItem('saved-javascript', editors.javascript.getCode());\r\n      localStorage.setItem('saved-html', editors.html.getCode());\r\n      localStorage.setItem('saved-css', editors.css.getCode());\r\n\r\n      localStorage.setItem('saved-processors', JSON.stringify({\r\n        javascript: jsbin.panels.named.javascript.processor.id,\r\n        html: jsbin.panels.named.html.processor.id,\r\n        css: jsbin.panels.named.css.processor.id,\r\n      }));\r\n\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'notification',\r\n        content: 'Starting template updated and saved',\r\n        autohide: 3000\r\n      });\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'Saving templates isn\\'t supported in this browser I\\'m afraid. Sorry'\r\n      });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // if (localStorage && localStorage['saved-html']) {\r\n    // $startingpoint.append('')\r\n  // }\r\n\r\n  $('a.disabled').on('click mousedown mouseup', function (event) {\r\n    event.stopImmediatePropagation();\r\n    return false;\r\n  });\r\n\r\n  $('#loginbtn').click(function () {\r\n    analytics.login();\r\n    $(this).toggleClass('open');\r\n    // $('#login').show();\r\n    // loginVisible = true;\r\n    // return false;\r\n  });\r\n\r\n  $('a.logout').click(function (event) {\r\n    event.preventDefault();\r\n\r\n    // We submit a form here because I can't work out how to style the button\r\n    // element in the form to look the same as the anchor. Ideally we would\r\n    // remove that and just let the form submit itself...\r\n    $(this.hash).submit();\r\n    // Clear session storage so private bins wont be cached.\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n  });\r\n\r\n  $('.homebtn').click(function (event, data) {\r\n    if (this.id === 'avatar') {\r\n      analytics.openFromAvatar();\r\n    } else if (this.id === 'profile') {\r\n      analytics.openFromAvatar();\r\n      $(this).closest('.open').removeClass('open');\r\n    } else {\r\n      analytics.open(data);\r\n    }\r\n\r\n    hideOpen();\r\n\r\n    jsbin.panels.hideAll();\r\n    return false;\r\n  });\r\n\r\n  var $lockrevision = $('div.lockrevision').on('click', function (event) {\r\n    event.preventDefault();\r\n    jsbin.saveChecksum = false;\r\n    jsbin.$document.trigger('locked');\r\n  }).on('mouseup', function () {\r\n    return false;\r\n  });\r\n\r\n  jsbin.$document.on('locked', function () {\r\n    if (!$lockrevision.data('locked')) {\r\n      analytics.lock();\r\n      $lockrevision.removeClass('icon-unlocked').addClass('icon-lock');\r\n      $lockrevision.html('<span>This bin is now locked from further changes</span>');\r\n      $lockrevision.data('locked', true);\r\n    }\r\n  });\r\n\r\n  // var $lockrevision = $('.lockrevision').on('click', function (event) {\r\n  // });\r\n\r\n  jsbin.$document.on('saved', function () {\r\n    $lockrevision.removeClass('icon-lock').addClass('icon-unlocked').data('locked', false);\r\n    $lockrevision.html('<span>Click to lock and prevent further changes</span>');\r\n  });\r\n\r\n  // TODO decide whether to remove this, since it definitely doesn't work!\r\n  // $('#share input[type=text], #share textarea').on('beforecopy', function (event) {\r\n  //   console.log(this, this.getAttribute('data-path'));\r\n  //   analytics.share('copy', this.getAttribute('data-path').substring(1) || 'output');\r\n  // });\r\n\r\n  if (!$('#sharemenu .share-split').length) {\r\n    var $panelCheckboxes = $('#sharepanels input[type=\"checkbox\"]').on('change', function () {\r\n      updateSavedState();\r\n    });\r\n    $('#sharemenu').bind('open', function () {\r\n      $panelCheckboxes.attr('checked', false);\r\n      jsbin.panels.getVisible().forEach(function (panel) {\r\n        $panelCheckboxes.filter('[data-panel=\"' + panel.id + '\"]').prop('checked', true).change();\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  var dropdownOpen = false,\r\n      onhover = false,\r\n      menuDown = false;\r\n\r\n  function opendropdown(el, nofocus) {\r\n    var menu;\r\n    if (!dropdownOpen) {\r\n      menu = $(el).closest('.menu').addClass('open').trigger('open');\r\n      // $body.addClass('menuinfo');\r\n      analytics.openMenu(el.hash.substring(1));\r\n      var input = menu.find(':text:visible:first');\r\n\r\n      if (input.length && !jsbin.mobile) {\r\n        input.focus();\r\n        setTimeout(function () {\r\n          input[0].select();\r\n        }, 0);\r\n      }\r\n      dropdownOpen = el;\r\n    }\r\n  }\r\n\r\n  function closedropdown() {\r\n    menuDown = false;\r\n    if (dropdownOpen) {\r\n      dropdownButtons.closest('.menu').removeClass('open').trigger('close');\r\n      // $body.removeClass('menuinfo');\r\n      dropdownOpen = false;\r\n      onhover = false;\r\n      var f = jsbin.panels.focused;\r\n      if (f && !jsbin.mobile) {\r\n        f.focus();\r\n        if (f.editor) {\r\n          f.editor.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var dropdownButtons = $('.button-dropdown, .button-open').mousedown(function (e) {\r\n    $dropdownLinks.removeClass('hover');\r\n    if (dropdownOpen && dropdownOpen !== this) {\r\n      closedropdown();\r\n    }\r\n    if (!dropdownOpen) {\r\n      menuDown = true;\r\n      opendropdown(this);\r\n    }\r\n    e.preventDefault();\r\n    return false;\r\n  }).mouseup(function () {\r\n    if (menuDown) return false;\r\n  }).click(function () {\r\n    if (!menuDown) {\r\n      analytics.closeMenu(this.hash.substring(1));\r\n      closedropdown();\r\n    }\r\n    if (menuDown) {\r\n      $(this.hash).attr('tabindex', 0);\r\n      menuDown = false;\r\n      return jsbin.mobile;\r\n    }\r\n\r\n    menuDown = false;\r\n\r\n    $(this.hash).attr('tabindex', -1);\r\n    return false;\r\n  });\r\n\r\n  $('#actionmenu').click(function () {\r\n    dropdownOpen = true;\r\n  });\r\n\r\n  var ignoreUp = false;\r\n  $body.bind('mousedown', function (event) {\r\n    if (dropdownOpen) {\r\n      if ($(event.target).closest('.menu').length) {\r\n        ignoreUp = true;\r\n      }\r\n    }\r\n  }).bind('click mouseup', function (event) {\r\n    if (dropdownOpen && !ignoreUp) {\r\n      if (!$(event.target).closest('.menu').length) {\r\n        closedropdown();\r\n        return false;\r\n      }\r\n    }\r\n    ignoreUp = false;\r\n  });\r\n\r\n  var fromClick = false;\r\n  var $dropdownLinks = $('.dropdownmenu a, .dropdownmenu .button').mouseup(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n\r\n    setTimeout(closedropdown, 0);\r\n    analytics.selectMenu(this.getAttribute('data-label') || this.hash.substring(1) || this.href);\r\n    if (!fromClick) {\r\n      if (this.hostname === window.location.hostname) {\r\n        if ($(this).triggerHandler('click') !== false) {\r\n          window.location = this.href;\r\n        }\r\n      } else {\r\n        if (this.getAttribute('target')) {\r\n          window.open(this.href);\r\n        } else {\r\n          window.location = this.href;\r\n        }\r\n      }\r\n    }\r\n    fromClick = false;\r\n  }).mouseover(function () {\r\n    $dropdownLinks.removeClass('hover');\r\n    $(this).addClass('hover');\r\n  }).mousedown(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n    fromClick = true;\r\n  });\r\n\r\n  $('#jsbinurl').click(function (e) {\r\n    setTimeout(function () {\r\n      jsbin.panels.named.live.hide();\r\n    }, 0);\r\n  });\r\n\r\n  $('#runwithalerts, li.run-with-js a').click(function (event, data) {\r\n    analytics.run(data);\r\n    if (editors.console.visible) {\r\n      editors.console.render(true);\r\n    } else {\r\n      renderLivePreview(true);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#runconsole').click(function () {\r\n    analytics.runconsole();\r\n    editors.console.render(true);\r\n    return false;\r\n  });\r\n\r\n  $('#clearconsole').click(function () {\r\n    jsconsole.clear();\r\n    return false;\r\n  });\r\n\r\n  $('#showhelp').click(function () {\r\n    $body.toggleClass('keyboardHelp');\r\n    keyboardHelpVisible = $body.is('.keyboardHelp');\r\n    if (keyboardHelpVisible) {\r\n      // analytics.help('keyboard');\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('a.toggle-side-nav').on(jsbin.mobile ? 'touchstart' : 'click', function () {\r\n    $body.toggleClass('show-nav');\r\n    sideNavVisible = $body.is('.show-nav');\r\n    if (!sideNavVisible && !jsbin.mobile) {\r\n      // we only focus the editor in desktop, otherwise the keyboard jumps up\r\n      $('#skipToEditor').click();\r\n    }\r\n    return sideNavVisible;\r\n  });\r\n\r\n\r\n  $('#showurls').click(function () {\r\n    $body.toggleClass('urlHelp');\r\n    urlHelpVisible = $body.is('.urlHelp');\r\n    if (urlHelpVisible) {\r\n      // analytics.urls();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('.code.panel > .label > span.name').dblclick(function () {\r\n    jsbin.panels.allEditors(function (panel) {\r\n      var lineNumbers = !panel.editor.getOption('lineNumbers');\r\n      panel.editor.setOption('lineNumbers', lineNumbers);\r\n      jsbin.settings.editor.lineNumbers = lineNumbers;\r\n    });\r\n  });\r\n\r\n  $('a.createnew').click(function (event) {\r\n    event.preventDefault();\r\n    var i, key;\r\n    analytics.createNew();\r\n    // FIXME this is out and out [cr]lazy....\r\n    jsbin.panels.savecontent = function(){};\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n\r\n    // clear out the write checksum too\r\n    store.sessionStorage.removeItem('checksum');\r\n\r\n    jsbin.panels.saveOnExit = false;\r\n\r\n    // first try to restore their default panels\r\n    jsbin.panels.restore();\r\n\r\n    // if nothing was shown, show html & live\r\n    setTimeout(function () {\r\n      if (jsbin.panels.getVisible().length === 0) {\r\n        jsbin.panels.named.html.show();\r\n        jsbin.panels.named.live.show();\r\n      }\r\n      window.location = jsbin.root;\r\n    }, 0);\r\n  });\r\n\r\n  var $privateButton = $('#control a.visibilityToggle#private');\r\n  var $publicButton = $('#control a.visibilityToggle#public');\r\n\r\n  var $visibilityButtons = $('#control a.visibilityToggle').click(function(event) {\r\n    event.preventDefault();\r\n\r\n    var visibility = $(this).data('vis');\r\n\r\n    $.ajax({\r\n      url: jsbin.getURL({ withRevision: true }) + '/' + visibility,\r\n      type: 'post',\r\n      success: function (data) {\r\n\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now ' + visibility,\r\n          autohide: 6000\r\n        });\r\n\r\n        $visibilityButtons.css('display', 'none');\r\n\r\n        if (visibility === 'public') {\r\n          $privateButton.css('display', 'block');\r\n        } else {\r\n          $publicButton.css('display', 'block');\r\n        }\r\n\r\n      }\r\n    });\r\n  });\r\n\r\n  $('form.login').closest('.menu').bind('close', function () {\r\n    $(this).find('.loginFeedback').empty().hide();\r\n    $('#login').removeClass('forgot');\r\n  });\r\n\r\n  $('#lostpass').click(function (e) {\r\n    $('#login').addClass('forgot').find('input[name=email]').focus();\r\n    return false;\r\n  });\r\n\r\n  jsbin.settings.includejs = jsbin.settings.includejs === undefined ? true : jsbin.settings.includejs;\r\n\r\n  // ignore for embed as there might be a lot of embeds on the page\r\n  if (!jsbin.embed && store.sessionStorage.getItem('runnerPending')) {\r\n    jsbin.$document.trigger('tip', {\r\n      content: 'It looks like your last session may have crashed, so I\\'ve disabled \"Auto-run JS\" for you',\r\n      type: 'error',\r\n    });\r\n    store.sessionStorage.removeItem('runnerPending');\r\n    jsbin.settings.includejs = false;\r\n  }\r\n\r\n  $('#enablejs').change(function () {\r\n    jsbin.settings.includejs = this.checked;\r\n    analytics.enableLiveJS(jsbin.settings.includejs);\r\n    editors.live.render();\r\n  }).attr('checked', jsbin.settings.includejs);\r\n\r\n  if (!jsbin.embed && jsbin.settings.hideheader) {\r\n    $body.addClass('hideheader');\r\n  }\r\n\r\n  var cancelUp = false;\r\n  $('form input, form textarea').focus(function () {\r\n    this.select();\r\n    cancelUp = true;\r\n  }).mouseup(function () {\r\n    if (cancelUp) {\r\n      cancelUp = false;\r\n      return false;\r\n    }\r\n  });\r\n\r\n  if (window.location.hash) {\r\n    $('a[href$=\"' + window.location.hash + '\"]').mousedown();\r\n  }\r\n\r\n  var ismac = navigator.userAgent.indexOf(' Mac ') !== -1,\r\n      mackeys = {\r\n        'ctrl': '⌘',\r\n        'shift': '⇧',\r\n        'del': '⌫'\r\n      };\r\n\r\n  $('#control').find('a[data-shortcut]').each(function () {\r\n    var $this = $(this),\r\n        data = $this.data();\r\n\r\n    var key = data.shortcut;\r\n    if (ismac) {\r\n      key = key.replace(/ctrl/i, mackeys.ctrl).replace(/shift/, mackeys.shift).replace(/del/, mackeys.del).replace(/\\+/g, '').toUpperCase();\r\n    }\r\n\r\n    $this.append('<span class=\"keyshortcut\">' + key + '</span>');\r\n  });\r\n\r\n  (function () {\r\n\r\n  var re = {\r\n    head: /<head(.*)\\n/i,\r\n    meta: /<meta name=\"description\".*?>/i,\r\n    metaContent: /content=\".*?\"/i\r\n  };\r\n\r\n  var metatag = '<meta name=\"description\" content=\"[add your bin description]\">\\n';\r\n\r\n  $('#addmeta').click(function () {\r\n    // if not - insert\r\n    // <meta name=\"description\" content=\"\" />\r\n    // if meta description is in the HTML, highlight it\r\n    var editor = jsbin.panels.named.html,\r\n        cm = editor.editor,\r\n        html = editor.getCode();\r\n\r\n    if (!editor.visible) {\r\n      editor.show();\r\n    }\r\n\r\n    if (!re.meta.test(html)) {\r\n      if (re.head.test(html)) {\r\n        html = html.replace(re.head, '<head$1\\n' + metatag);\r\n      } else {\r\n        // slap in the top\r\n        html = metatag + html;\r\n      }\r\n    }\r\n\r\n    editor.setCode(html);\r\n\r\n    // now select the text\r\n    // editor.editor is the CM object...yeah, sorry about that...\r\n    var cursor = cm.getSearchCursor(re.meta);\r\n    cursor.findNext();\r\n\r\n    var contentCursor = cm.getSearchCursor(re.metaContent);\r\n    contentCursor.findNext();\r\n\r\n    var from = { line: cursor.pos.from.line, ch: cursor.pos.from.ch + '<meta name=\"description\" content=\"'.length },\r\n        to = { line: contentCursor.pos.to.line, ch: contentCursor.pos.to.ch - 1 };\r\n\r\n    cm.setCursor(from);\r\n    cm.setSelection(from, to);\r\n    cm.on('cursoractivity', function () {\r\n      cm.on('cursoractivity', null);\r\n      mark.clear();\r\n    });\r\n\r\n    var mark = cm.markText(from, to, { className: 'highlight' });\r\n\r\n    cm.focus();\r\n\r\n    return false;\r\n  });\r\n\r\n  $('a.publish-to-vanity').on('click', function (event) {\r\n    event.preventDefault();\r\n    analytics.publishVanity();\r\n\r\n    $.ajax({\r\n      type: 'post',\r\n      url: this.href,\r\n      data: { url: jsbin.getURL({ withRevision: true }) },\r\n      success: function () {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now published to your vanity URL: <a target=\"_blank\" href=\"' + jsbin.shareRoot + '\">' + jsbin.shareRoot + '</a>'\r\n        });\r\n      },\r\n      error: function (xhr) {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'error',\r\n          content: 'There was a problem publishing to your vanity URL. Can you try again or file a <a target=\"_blank\" href=\"' + githubIssue() + '\">new issue</a>?'\r\n        });\r\n      }\r\n    })\r\n  });\r\n\r\n  jsbin.$document.on('click', 'a.deleteallbins', function () {\r\n    if (jsbin.user && jsbin.state.metadata.name === jsbin.user.name) {\r\n      if (confirm('Delete all snapshots of this bin including this one?')) {\r\n      analytics.deleteAll();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL() + '/delete-all',\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin and history is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target=\"_blank\" href=\"/help/delete-a-bin\">Need help?</a>'\r\n      });\r\n    }\r\n  });\r\n\r\n  $('a.deletebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    if (confirm('Delete this bin?')) {\r\n      analytics['delete']();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL({ withRevision: true }) + '/delete',\r\n        data: { checksum: jsbin.state.checksum },\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n  });\r\n\r\n  $('a.archivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive();\r\n  });\r\n\r\n  $('a.unarchivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive(false);\r\n  });\r\n\r\n  var $enableUniversalEditor = $('#enableUniversalEditor').on('change', function (e) {\r\n    e.preventDefault();\r\n\r\n    jsbin.settings.editor.simple = this.checked;\r\n    analytics.universalEditor(jsbin.settings.editor.simple);\r\n    settings.save(function () {\r\n      window.location.reload();\r\n    });\r\n  });\r\n\r\n  if (jsbin.settings.editor.simple) {\r\n    $enableUniversalEditor.prop('checked', true);\r\n  }\r\n\r\n  $('#skipToEditor').on('click keypress', function () {\r\n    var first = (jsbin.panels.getVisible() || ['html']).shift();\r\n    if (jsbin.settings.editor.simple || jsbin.mobile) {\r\n      $('#' + first.id).focus();\r\n    } else if (first) {\r\n      first.editor.focus();\r\n    } else {\r\n      jsbin.panels.named.html.editor.focus();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  }());\r\n\r\n});"]}