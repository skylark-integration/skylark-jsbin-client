{"version":3,"sources":["chrome/navigation.js"],"names":["define","$","jsbin","click","event","preventDefault","localStorage","analytics","saveTemplate","setItem","editors","javascript","getCode","html","css","JSON","stringify","panels","processor","id","$document","trigger","type","content","autohide","on","stopImmediatePropagation","login","this","toggleClass","hash","submit","i","store","sessionStorage","length","key","indexOf","removeItem","data","openFromAvatar","closest","removeClass","open","hideOpen","hideAll","$lockrevision","saveChecksum","lock","addClass","$panelCheckboxes","updateSavedState","bind","attr","getVisible","forEach","panel","filter","prop","change","dropdownOpen","menuDown","closedropdown","dropdownButtons","f","focused","mobile","focus","editor","mousedown","e","$dropdownLinks","el","nofocus","menu","openMenu","substring","input","find","setTimeout","select","opendropdown","mouseup","closeMenu","ignoreUp","$body","target","fromClick","nodeName","selectMenu","getAttribute","href","hostname","window","location","triggerHandler","mouseover","live","hide","run","console","visible","render","renderLivePreview","runconsole","jsconsole","clear","keyboardHelpVisible","is","sideNavVisible","urlHelpVisible","dblclick","allEditors","lineNumbers","getOption","setOption","settings","createNew","savecontent","saveOnExit","restore","show","root","$privateButton","$publicButton","$visibilityButtons","visibility","ajax","url","getURL","withRevision","success","empty","includejs","undefined","embed","getItem","checked","enableLiveJS","hideheader","cancelUp","ismac","navigator","userAgent","mackeys","each","$this","shortcut","replace","toUpperCase","append","re","head","meta","metaContent","metatag","cm","test","setCode","cursor","getSearchCursor","findNext","contentCursor","from","line","pos","ch","to","setCursor","setSelection","mark","markText","className","publishVanity","shareRoot","error","xhr","githubIssue","user","state","metadata","name","confirm","deleteAll","deleted","status","checksum","archive","$enableUniversalEditor","simple","universalEditor","save","reload","first","shift"],"mappings":"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","file":"../../chrome/navigation.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n   \"../jsbin\"\r\n],function ($,jsbin) {\r\n  var $startingpoint = $('a.startingpoint').click(function (event) {\r\n    event.preventDefault();\r\n    if (localStorage) {\r\n      analytics.saveTemplate();\r\n      localStorage.setItem('saved-javascript', editors.javascript.getCode());\r\n      localStorage.setItem('saved-html', editors.html.getCode());\r\n      localStorage.setItem('saved-css', editors.css.getCode());\r\n\r\n      localStorage.setItem('saved-processors', JSON.stringify({\r\n        javascript: jsbin.panels.panels.javascript.processor.id,\r\n        html: jsbin.panels.panels.html.processor.id,\r\n        css: jsbin.panels.panels.css.processor.id,\r\n      }));\r\n\r\n      $document.trigger('tip', {\r\n        type: 'notification',\r\n        content: 'Starting template updated and saved',\r\n        autohide: 3000\r\n      });\r\n    } else {\r\n      $document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'Saving templates isn\\'t supported in this browser I\\'m afraid. Sorry'\r\n      });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // if (localStorage && localStorage['saved-html']) {\r\n    // $startingpoint.append('')\r\n  // }\r\n\r\n  $('a.disabled').on('click mousedown mouseup', function (event) {\r\n    event.stopImmediatePropagation();\r\n    return false;\r\n  });\r\n\r\n  $('#loginbtn').click(function () {\r\n    analytics.login();\r\n    $(this).toggleClass('open');\r\n    // $('#login').show();\r\n    // loginVisible = true;\r\n    // return false;\r\n  });\r\n\r\n  $('a.logout').click(function (event) {\r\n    event.preventDefault();\r\n\r\n    // We submit a form here because I can't work out how to style the button\r\n    // element in the form to look the same as the anchor. Ideally we would\r\n    // remove that and just let the form submit itself...\r\n    $(this.hash).submit();\r\n    // Clear session storage so private bins wont be cached.\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n  });\r\n\r\n  $('.homebtn').click(function (event, data) {\r\n    if (this.id === 'avatar') {\r\n      analytics.openFromAvatar();\r\n    } else if (this.id === 'profile') {\r\n      analytics.openFromAvatar();\r\n      $(this).closest('.open').removeClass('open');\r\n    } else {\r\n      analytics.open(data);\r\n    }\r\n\r\n    hideOpen();\r\n\r\n    jsbin.panels.hideAll();\r\n    return false;\r\n  });\r\n\r\n  var $lockrevision = $('div.lockrevision').on('click', function (event) {\r\n    event.preventDefault();\r\n    saveChecksum = false;\r\n    $document.trigger('locked');\r\n  }).on('mouseup', function () {\r\n    return false;\r\n  });\r\n\r\n  $document.on('locked', function () {\r\n    if (!$lockrevision.data('locked')) {\r\n      analytics.lock();\r\n      $lockrevision.removeClass('icon-unlocked').addClass('icon-lock');\r\n      $lockrevision.html('<span>This bin is now locked from further changes</span>');\r\n      $lockrevision.data('locked', true);\r\n    }\r\n  });\r\n\r\n  // var $lockrevision = $('.lockrevision').on('click', function (event) {\r\n  // });\r\n\r\n  $document.on('saved', function () {\r\n    $lockrevision.removeClass('icon-lock').addClass('icon-unlocked').data('locked', false);\r\n    $lockrevision.html('<span>Click to lock and prevent further changes</span>');\r\n  });\r\n\r\n  // TODO decide whether to remove this, since it definitely doesn't work!\r\n  // $('#share input[type=text], #share textarea').on('beforecopy', function (event) {\r\n  //   console.log(this, this.getAttribute('data-path'));\r\n  //   analytics.share('copy', this.getAttribute('data-path').substring(1) || 'output');\r\n  // });\r\n\r\n  if (!$('#sharemenu .share-split').length) {\r\n    var $panelCheckboxes = $('#sharepanels input[type=\"checkbox\"]').on('change', function () {\r\n      updateSavedState();\r\n    });\r\n    $('#sharemenu').bind('open', function () {\r\n      $panelCheckboxes.attr('checked', false);\r\n      jsbin.panels.getVisible().forEach(function (panel) {\r\n        $panelCheckboxes.filter('[data-panel=\"' + panel.id + '\"]').prop('checked', true).change();\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n  var dropdownOpen = false,\r\n      onhover = false,\r\n      menuDown = false;\r\n\r\n  function opendropdown(el, nofocus) {\r\n    var menu;\r\n    if (!dropdownOpen) {\r\n      menu = $(el).closest('.menu').addClass('open').trigger('open');\r\n      // $body.addClass('menuinfo');\r\n      analytics.openMenu(el.hash.substring(1));\r\n      var input = menu.find(':text:visible:first');\r\n\r\n      if (input.length && !jsbin.mobile) {\r\n        input.focus();\r\n        setTimeout(function () {\r\n          input[0].select();\r\n        }, 0);\r\n      }\r\n      dropdownOpen = el;\r\n    }\r\n  }\r\n\r\n  function closedropdown() {\r\n    menuDown = false;\r\n    if (dropdownOpen) {\r\n      dropdownButtons.closest('.menu').removeClass('open').trigger('close');\r\n      // $body.removeClass('menuinfo');\r\n      dropdownOpen = false;\r\n      onhover = false;\r\n      var f = jsbin.panels.focused;\r\n      if (f && !jsbin.mobile) {\r\n        f.focus();\r\n        if (f.editor) {\r\n          f.editor.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var dropdownButtons = $('.button-dropdown, .button-open').mousedown(function (e) {\r\n    $dropdownLinks.removeClass('hover');\r\n    if (dropdownOpen && dropdownOpen !== this) {\r\n      closedropdown();\r\n    }\r\n    if (!dropdownOpen) {\r\n      menuDown = true;\r\n      opendropdown(this);\r\n    }\r\n    e.preventDefault();\r\n    return false;\r\n  }).mouseup(function () {\r\n    if (menuDown) return false;\r\n  }).click(function () {\r\n    if (!menuDown) {\r\n      analytics.closeMenu(this.hash.substring(1));\r\n      closedropdown();\r\n    }\r\n    if (menuDown) {\r\n      $(this.hash).attr('tabindex', 0);\r\n      menuDown = false;\r\n      return jsbin.mobile;\r\n    }\r\n\r\n    menuDown = false;\r\n\r\n    $(this.hash).attr('tabindex', -1);\r\n    return false;\r\n  });\r\n\r\n  $('#actionmenu').click(function () {\r\n    dropdownOpen = true;\r\n  });\r\n\r\n  var ignoreUp = false;\r\n  $body.bind('mousedown', function (event) {\r\n    if (dropdownOpen) {\r\n      if ($(event.target).closest('.menu').length) {\r\n        ignoreUp = true;\r\n      }\r\n    }\r\n  }).bind('click mouseup', function (event) {\r\n    if (dropdownOpen && !ignoreUp) {\r\n      if (!$(event.target).closest('.menu').length) {\r\n        closedropdown();\r\n        return false;\r\n      }\r\n    }\r\n    ignoreUp = false;\r\n  });\r\n\r\n  var fromClick = false;\r\n  var $dropdownLinks = $('.dropdownmenu a, .dropdownmenu .button').mouseup(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n\r\n    setTimeout(closedropdown, 0);\r\n    analytics.selectMenu(this.getAttribute('data-label') || this.hash.substring(1) || this.href);\r\n    if (!fromClick) {\r\n      if (this.hostname === window.location.hostname) {\r\n        if ($(this).triggerHandler('click') !== false) {\r\n          window.location = this.href;\r\n        }\r\n      } else {\r\n        if (this.getAttribute('target')) {\r\n          window.open(this.href);\r\n        } else {\r\n          window.location = this.href;\r\n        }\r\n      }\r\n    }\r\n    fromClick = false;\r\n  }).mouseover(function () {\r\n    $dropdownLinks.removeClass('hover');\r\n    $(this).addClass('hover');\r\n  }).mousedown(function (e) {\r\n    if (e.target.nodeName === 'INPUT') {\r\n      return;\r\n    }\r\n    fromClick = true;\r\n  });\r\n\r\n  $('#jsbinurl').click(function (e) {\r\n    setTimeout(function () {\r\n      jsbin.panels.panels.live.hide();\r\n    }, 0);\r\n  });\r\n\r\n  $('#runwithalerts, li.run-with-js a').click(function (event, data) {\r\n    analytics.run(data);\r\n    if (editors.console.visible) {\r\n      editors.console.render(true);\r\n    } else {\r\n      renderLivePreview(true);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#runconsole').click(function () {\r\n    analytics.runconsole();\r\n    editors.console.render(true);\r\n    return false;\r\n  });\r\n\r\n  $('#clearconsole').click(function () {\r\n    jsconsole.clear();\r\n    return false;\r\n  });\r\n\r\n  $('#showhelp').click(function () {\r\n    $body.toggleClass('keyboardHelp');\r\n    keyboardHelpVisible = $body.is('.keyboardHelp');\r\n    if (keyboardHelpVisible) {\r\n      // analytics.help('keyboard');\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('a.toggle-side-nav').on(jsbin.mobile ? 'touchstart' : 'click', function () {\r\n    $body.toggleClass('show-nav');\r\n    sideNavVisible = $body.is('.show-nav');\r\n    if (!sideNavVisible && !jsbin.mobile) {\r\n      // we only focus the editor in desktop, otherwise the keyboard jumps up\r\n      $('#skipToEditor').click();\r\n    }\r\n    return sideNavVisible;\r\n  });\r\n\r\n\r\n  $('#showurls').click(function () {\r\n    $body.toggleClass('urlHelp');\r\n    urlHelpVisible = $body.is('.urlHelp');\r\n    if (urlHelpVisible) {\r\n      // analytics.urls();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('.code.panel > .label > span.name').dblclick(function () {\r\n    jsbin.panels.allEditors(function (panel) {\r\n      var lineNumbers = !panel.editor.getOption('lineNumbers');\r\n      panel.editor.setOption('lineNumbers', lineNumbers);\r\n      jsbin.settings.editor.lineNumbers = lineNumbers;\r\n    });\r\n  });\r\n\r\n  $('a.createnew').click(function (event) {\r\n    event.preventDefault();\r\n    var i, key;\r\n    analytics.createNew();\r\n    // FIXME this is out and out [cr]lazy....\r\n    jsbin.panels.savecontent = function(){};\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n\r\n    // clear out the write checksum too\r\n    store.sessionStorage.removeItem('checksum');\r\n\r\n    jsbin.panels.saveOnExit = false;\r\n\r\n    // first try to restore their default panels\r\n    jsbin.panels.restore();\r\n\r\n    // if nothing was shown, show html & live\r\n    setTimeout(function () {\r\n      if (jsbin.panels.getVisible().length === 0) {\r\n        jsbin.panels.panels.html.show();\r\n        jsbin.panels.panels.live.show();\r\n      }\r\n      window.location = jsbin.root;\r\n    }, 0);\r\n  });\r\n\r\n  var $privateButton = $('#control a.visibilityToggle#private');\r\n  var $publicButton = $('#control a.visibilityToggle#public');\r\n\r\n  var $visibilityButtons = $('#control a.visibilityToggle').click(function(event) {\r\n    event.preventDefault();\r\n\r\n    var visibility = $(this).data('vis');\r\n\r\n    $.ajax({\r\n      url: jsbin.getURL({ withRevision: true }) + '/' + visibility,\r\n      type: 'post',\r\n      success: function (data) {\r\n\r\n        $document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now ' + visibility,\r\n          autohide: 6000\r\n        });\r\n\r\n        $visibilityButtons.css('display', 'none');\r\n\r\n        if (visibility === 'public') {\r\n          $privateButton.css('display', 'block');\r\n        } else {\r\n          $publicButton.css('display', 'block');\r\n        }\r\n\r\n      }\r\n    });\r\n  });\r\n\r\n  $('form.login').closest('.menu').bind('close', function () {\r\n    $(this).find('.loginFeedback').empty().hide();\r\n    $('#login').removeClass('forgot');\r\n  });\r\n\r\n  $('#lostpass').click(function (e) {\r\n    $('#login').addClass('forgot').find('input[name=email]').focus();\r\n    return false;\r\n  });\r\n\r\n  jsbin.settings.includejs = jsbin.settings.includejs === undefined ? true : jsbin.settings.includejs;\r\n\r\n  // ignore for embed as there might be a lot of embeds on the page\r\n  if (!jsbin.embed && store.sessionStorage.getItem('runnerPending')) {\r\n    $document.trigger('tip', {\r\n      content: 'It looks like your last session may have crashed, so I\\'ve disabled \"Auto-run JS\" for you',\r\n      type: 'error',\r\n    });\r\n    store.sessionStorage.removeItem('runnerPending');\r\n    jsbin.settings.includejs = false;\r\n  }\r\n\r\n  $('#enablejs').change(function () {\r\n    jsbin.settings.includejs = this.checked;\r\n    analytics.enableLiveJS(jsbin.settings.includejs);\r\n    editors.live.render();\r\n  }).attr('checked', jsbin.settings.includejs);\r\n\r\n  if (!jsbin.embed && jsbin.settings.hideheader) {\r\n    $body.addClass('hideheader');\r\n  }\r\n\r\n  var cancelUp = false;\r\n  $('form input, form textarea').focus(function () {\r\n    this.select();\r\n    cancelUp = true;\r\n  }).mouseup(function () {\r\n    if (cancelUp) {\r\n      cancelUp = false;\r\n      return false;\r\n    }\r\n  });\r\n\r\n  if (window.location.hash) {\r\n    $('a[href$=\"' + window.location.hash + '\"]').mousedown();\r\n  }\r\n\r\n  var ismac = navigator.userAgent.indexOf(' Mac ') !== -1,\r\n      mackeys = {\r\n        'ctrl': '⌘',\r\n        'shift': '⇧',\r\n        'del': '⌫'\r\n      };\r\n\r\n  $('#control').find('a[data-shortcut]').each(function () {\r\n    var $this = $(this),\r\n        data = $this.data();\r\n\r\n    var key = data.shortcut;\r\n    if (ismac) {\r\n      key = key.replace(/ctrl/i, mackeys.ctrl).replace(/shift/, mackeys.shift).replace(/del/, mackeys.del).replace(/\\+/g, '').toUpperCase();\r\n    }\r\n\r\n    $this.append('<span class=\"keyshortcut\">' + key + '</span>');\r\n  });\r\n\r\n  (function () {\r\n\r\n  var re = {\r\n    head: /<head(.*)\\n/i,\r\n    meta: /<meta name=\"description\".*?>/i,\r\n    metaContent: /content=\".*?\"/i\r\n  };\r\n\r\n  var metatag = '<meta name=\"description\" content=\"[add your bin description]\">\\n';\r\n\r\n  $('#addmeta').click(function () {\r\n    // if not - insert\r\n    // <meta name=\"description\" content=\"\" />\r\n    // if meta description is in the HTML, highlight it\r\n    var editor = jsbin.panels.panels.html,\r\n        cm = editor.editor,\r\n        html = editor.getCode();\r\n\r\n    if (!editor.visible) {\r\n      editor.show();\r\n    }\r\n\r\n    if (!re.meta.test(html)) {\r\n      if (re.head.test(html)) {\r\n        html = html.replace(re.head, '<head$1\\n' + metatag);\r\n      } else {\r\n        // slap in the top\r\n        html = metatag + html;\r\n      }\r\n    }\r\n\r\n    editor.setCode(html);\r\n\r\n    // now select the text\r\n    // editor.editor is the CM object...yeah, sorry about that...\r\n    var cursor = cm.getSearchCursor(re.meta);\r\n    cursor.findNext();\r\n\r\n    var contentCursor = cm.getSearchCursor(re.metaContent);\r\n    contentCursor.findNext();\r\n\r\n    var from = { line: cursor.pos.from.line, ch: cursor.pos.from.ch + '<meta name=\"description\" content=\"'.length },\r\n        to = { line: contentCursor.pos.to.line, ch: contentCursor.pos.to.ch - 1 };\r\n\r\n    cm.setCursor(from);\r\n    cm.setSelection(from, to);\r\n    cm.on('cursoractivity', function () {\r\n      cm.on('cursoractivity', null);\r\n      mark.clear();\r\n    });\r\n\r\n    var mark = cm.markText(from, to, { className: 'highlight' });\r\n\r\n    cm.focus();\r\n\r\n    return false;\r\n  });\r\n\r\n  $('a.publish-to-vanity').on('click', function (event) {\r\n    event.preventDefault();\r\n    analytics.publishVanity();\r\n\r\n    $.ajax({\r\n      type: 'post',\r\n      url: this.href,\r\n      data: { url: jsbin.getURL({ withRevision: true }) },\r\n      success: function () {\r\n        $document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now published to your vanity URL: <a target=\"_blank\" href=\"' + jsbin.shareRoot + '\">' + jsbin.shareRoot + '</a>'\r\n        });\r\n      },\r\n      error: function (xhr) {\r\n        $document.trigger('tip', {\r\n          type: 'error',\r\n          content: 'There was a problem publishing to your vanity URL. Can you try again or file a <a target=\"_blank\" href=\"' + githubIssue() + '\">new issue</a>?'\r\n        });\r\n      }\r\n    })\r\n  });\r\n\r\n  $document.on('click', 'a.deleteallbins', function () {\r\n    if (jsbin.user && jsbin.state.metadata.name === jsbin.user.name) {\r\n      if (confirm('Delete all snapshots of this bin including this one?')) {\r\n      analytics.deleteAll();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL() + '/delete-all',\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          $document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin and history is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            $document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n    } else {\r\n      $document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target=\"_blank\" href=\"/help/delete-a-bin\">Need help?</a>'\r\n      });\r\n    }\r\n  });\r\n\r\n  $('a.deletebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    if (confirm('Delete this bin?')) {\r\n      analytics['delete']();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL({ withRevision: true }) + '/delete',\r\n        data: { checksum: jsbin.state.checksum },\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          $document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            $document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n  });\r\n\r\n  $('a.archivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive();\r\n  });\r\n\r\n  $('a.unarchivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive(false);\r\n  });\r\n\r\n  var $enableUniversalEditor = $('#enableUniversalEditor').on('change', function (e) {\r\n    e.preventDefault();\r\n\r\n    jsbin.settings.editor.simple = this.checked;\r\n    analytics.universalEditor(jsbin.settings.editor.simple);\r\n    settings.save(function () {\r\n      window.location.reload();\r\n    });\r\n  });\r\n\r\n  if (jsbin.settings.editor.simple) {\r\n    $enableUniversalEditor.prop('checked', true);\r\n  }\r\n\r\n  $('#skipToEditor').on('click keypress', function () {\r\n    var first = (jsbin.panels.getVisible() || ['html']).shift();\r\n    if (jsbin.settings.editor.simple || jsbin.mobile) {\r\n      $('#' + first.id).focus();\r\n    } else if (first) {\r\n      first.editor.focus();\r\n    } else {\r\n      jsbin.panels.panels.html.editor.focus();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  }());\r\n\r\n});"]}