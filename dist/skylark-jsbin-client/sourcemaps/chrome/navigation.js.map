{"version":3,"sources":["chrome/navigation.js"],"names":["define","$","store","hideOpen","panels","jsbin","analytics","archive","settings","click","event","preventDefault","localStorage","saveTemplate","setItem","named","javascript","getCode","html","css","JSON","stringify","processor","id","$document","trigger","type","content","autohide","on","stopImmediatePropagation","login","this","toggleClass","hash","submit","i","sessionStorage","length","key","indexOf","removeItem","data","openFromAvatar","closest","removeClass","open","hideAll","$lockrevision","saveChecksum","lock","addClass","$panelCheckboxes","updateSavedState","bind","attr","getVisible","forEach","panel","filter","prop","change","e","setTimeout","live","hide","run","console","visible","render","renderLivePreview","runconsole","jsconsole","clear","$body","keyboardHelpVisible","is","mobile","sideNavVisible","urlHelpVisible","dblclick","allEditors","lineNumbers","editor","getOption","setOption","createNew","savecontent","saveOnExit","restore","show","window","location","root","$privateButton","$publicButton","$visibilityButtons","visibility","ajax","url","getURL","withRevision","success","find","empty","focus","includejs","undefined","embed","getItem","checked","enableLiveJS","hideheader","cancelUp","select","mouseup","mousedown","ismac","navigator","userAgent","mackeys","each","$this","shortcut","replace","toUpperCase","append","re","head","meta","metaContent","metatag","cm","test","setCode","cursor","getSearchCursor","findNext","contentCursor","from","line","pos","ch","to","setCursor","setSelection","mark","markText","className","publishVanity","href","shareRoot","error","xhr","githubIssue","user","state","metadata","name","confirm","deleteAll","deleted","status","checksum","$enableUniversalEditor","simple","universalEditor","save","reload","first","shift"],"mappings":"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","file":"../../chrome/navigation.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"skylark-jsbin-base/storage\",\r\n  \"skylark-jsbin-chrome/hideOpen\",\r\n  \"skylark-jsbin-coder/editors/panels\",\r\n   \"../jsbin\",\r\n   \"./analytics\",\r\n   \"./archive\",\r\n   \"./settings\"\r\n],function ($,store,hideOpen, panels,jsbin,analytics, archive,settings) {\r\n  var $startingpoint = $('a.startingpoint').click(function (event) {\r\n    event.preventDefault();\r\n    if (localStorage) {\r\n      analytics.saveTemplate();\r\n      localStorage.setItem('saved-javascript', panels.named.javascript.getCode());\r\n      localStorage.setItem('saved-html', panels.named.html.getCode());\r\n      localStorage.setItem('saved-css', panels.named.css.getCode());\r\n\r\n      localStorage.setItem('saved-processors', JSON.stringify({\r\n        javascript: panels.named.javascript.processor.id,\r\n        html: panels.named.html.processor.id,\r\n        css: panels.named.css.processor.id,\r\n      }));\r\n\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'notification',\r\n        content: 'Starting template updated and saved',\r\n        autohide: 3000\r\n      });\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'Saving templates isn\\'t supported in this browser I\\'m afraid. Sorry'\r\n      });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // if (localStorage && localStorage['saved-html']) {\r\n    // $startingpoint.append('')\r\n  // }\r\n\r\n  $('a.disabled').on('click mousedown mouseup', function (event) {\r\n    event.stopImmediatePropagation();\r\n    return false;\r\n  });\r\n\r\n  $('#loginbtn').click(function () {\r\n    analytics.login();\r\n    $(this).toggleClass('open');\r\n    // $('#login').show();\r\n    // loginVisible = true;\r\n    // return false;\r\n  });\r\n\r\n  $('a.logout').click(function (event) {\r\n    event.preventDefault();\r\n\r\n    // We submit a form here because I can't work out how to style the button\r\n    // element in the form to look the same as the anchor. Ideally we would\r\n    // remove that and just let the form submit itself...\r\n    $(this.hash).submit();\r\n    // Clear session storage so private bins wont be cached.\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n  });\r\n\r\n  $('.homebtn').click(function (event, data) {\r\n    if (this.id === 'avatar') {\r\n      analytics.openFromAvatar();\r\n    } else if (this.id === 'profile') {\r\n      analytics.openFromAvatar();\r\n      $(this).closest('.open').removeClass('open');\r\n    } else {\r\n      analytics.open(data);\r\n    }\r\n\r\n    hideOpen();\r\n\r\n    panels.hideAll();\r\n    return false;\r\n  });\r\n\r\n  var $lockrevision = $('div.lockrevision').on('click', function (event) {\r\n    event.preventDefault();\r\n    jsbin.saveChecksum = false;\r\n    jsbin.$document.trigger('locked');\r\n  }).on('mouseup', function () {\r\n    return false;\r\n  });\r\n\r\n  jsbin.$document.on('locked', function () {\r\n    if (!$lockrevision.data('locked')) {\r\n      analytics.lock();\r\n      $lockrevision.removeClass('icon-unlocked').addClass('icon-lock');\r\n      $lockrevision.html('<span>This bin is now locked from further changes</span>');\r\n      $lockrevision.data('locked', true);\r\n    }\r\n  });\r\n\r\n  // var $lockrevision = $('.lockrevision').on('click', function (event) {\r\n  // });\r\n\r\n  jsbin.$document.on('saved', function () {\r\n    $lockrevision.removeClass('icon-lock').addClass('icon-unlocked').data('locked', false);\r\n    $lockrevision.html('<span>Click to lock and prevent further changes</span>');\r\n  });\r\n\r\n  // TODO decide whether to remove this, since it definitely doesn't work!\r\n  // $('#share input[type=text], #share textarea').on('beforecopy', function (event) {\r\n  //   console.log(this, this.getAttribute('data-path'));\r\n  //   analytics.share('copy', this.getAttribute('data-path').substring(1) || 'output');\r\n  // });\r\n\r\n  if (!$('#sharemenu .share-split').length) {\r\n    var $panelCheckboxes = $('#sharepanels input[type=\"checkbox\"]').on('change', function () {\r\n      updateSavedState();\r\n    });\r\n    $('#sharemenu').bind('open', function () {\r\n      $panelCheckboxes.attr('checked', false);\r\n      panels.getVisible().forEach(function (panel) {\r\n        $panelCheckboxes.filter('[data-panel=\"' + panel.id + '\"]').prop('checked', true).change();\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n\r\n  $('#jsbinurl').click(function (e) {\r\n    setTimeout(function () {\r\n      panels.named.live.hide();\r\n    }, 0);\r\n  });\r\n\r\n  $('#runwithalerts, li.run-with-js a').click(function (event, data) {\r\n    analytics.run(data);\r\n    if (panels.named.console.visible) {\r\n      panels.named.console.render(true);\r\n    } else {\r\n      panels.renderLivePreview(true);\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('#runconsole').click(function () {\r\n    analytics.runconsole();\r\n    panels.named.console.render(true);\r\n    return false;\r\n  });\r\n\r\n  $('#clearconsole').click(function () {\r\n    jsconsole.clear();\r\n    return false;\r\n  });\r\n\r\n  $('#showhelp').click(function () {\r\n    $body.toggleClass('keyboardHelp');\r\n    keyboardHelpVisible = $body.is('.keyboardHelp');\r\n    if (keyboardHelpVisible) {\r\n      // analytics.help('keyboard');\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('a.toggle-side-nav').on(jsbin.mobile ? 'touchstart' : 'click', function () {\r\n    $body.toggleClass('show-nav');\r\n    sideNavVisible = $body.is('.show-nav');\r\n    if (!sideNavVisible && !jsbin.mobile) {\r\n      // we only focus the editor in desktop, otherwise the keyboard jumps up\r\n      $('#skipToEditor').click();\r\n    }\r\n    return sideNavVisible;\r\n  });\r\n\r\n\r\n  $('#showurls').click(function () {\r\n    $body.toggleClass('urlHelp');\r\n    urlHelpVisible = $body.is('.urlHelp');\r\n    if (urlHelpVisible) {\r\n      // analytics.urls();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  $('.code.panel > .label > span.name').dblclick(function () {\r\n    panels.allEditors(function (panel) {\r\n      var lineNumbers = !panel.editor.getOption('lineNumbers');\r\n      panel.editor.setOption('lineNumbers', lineNumbers);\r\n      jsbin.settings.editor.lineNumbers = lineNumbers;\r\n    });\r\n  });\r\n\r\n  $('a.createnew').click(function (event) {\r\n    event.preventDefault();\r\n    var i, key;\r\n    analytics.createNew();\r\n    // FIXME this is out and out [cr]lazy....\r\n    panels.savecontent = function(){};\r\n    for (i = 0; i < store.sessionStorage.length; i++) {\r\n      key = store.sessionStorage.key(i);\r\n      if (key.indexOf('jsbin.content.') === 0) {\r\n        store.sessionStorage.removeItem(key);\r\n      }\r\n    }\r\n\r\n    // clear out the write checksum too\r\n    store.sessionStorage.removeItem('checksum');\r\n\r\n    panels.saveOnExit = false;\r\n\r\n    // first try to restore their default panels\r\n    panels.restore();\r\n\r\n    // if nothing was shown, show html & live\r\n    setTimeout(function () {\r\n      if (panels.getVisible().length === 0) {\r\n        panels.named.html.show();\r\n        panels.named.live.show();\r\n      }\r\n      window.location = jsbin.root;\r\n    }, 0);\r\n  });\r\n\r\n  var $privateButton = $('#control a.visibilityToggle#private');\r\n  var $publicButton = $('#control a.visibilityToggle#public');\r\n\r\n  var $visibilityButtons = $('#control a.visibilityToggle').click(function(event) {\r\n    event.preventDefault();\r\n\r\n    var visibility = $(this).data('vis');\r\n\r\n    $.ajax({\r\n      url: jsbin.getURL({ withRevision: true }) + '/' + visibility,\r\n      type: 'post',\r\n      success: function (data) {\r\n\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now ' + visibility,\r\n          autohide: 6000\r\n        });\r\n\r\n        $visibilityButtons.css('display', 'none');\r\n\r\n        if (visibility === 'public') {\r\n          $privateButton.css('display', 'block');\r\n        } else {\r\n          $publicButton.css('display', 'block');\r\n        }\r\n\r\n      }\r\n    });\r\n  });\r\n\r\n  $('form.login').closest('.menu').bind('close', function () {\r\n    $(this).find('.loginFeedback').empty().hide();\r\n    $('#login').removeClass('forgot');\r\n  });\r\n\r\n  $('#lostpass').click(function (e) {\r\n    $('#login').addClass('forgot').find('input[name=email]').focus();\r\n    return false;\r\n  });\r\n\r\n  jsbin.settings.includejs = jsbin.settings.includejs === undefined ? true : jsbin.settings.includejs;\r\n\r\n  // ignore for embed as there might be a lot of embeds on the page\r\n  if (!jsbin.embed && store.sessionStorage.getItem('runnerPending')) {\r\n    jsbin.$document.trigger('tip', {\r\n      content: 'It looks like your last session may have crashed, so I\\'ve disabled \"Auto-run JS\" for you',\r\n      type: 'error',\r\n    });\r\n    store.sessionStorage.removeItem('runnerPending');\r\n    jsbin.settings.includejs = false;\r\n  }\r\n\r\n  $('#enablejs').change(function () {\r\n    jsbin.settings.includejs = this.checked;\r\n    analytics.enableLiveJS(jsbin.settings.includejs);\r\n    panels.named.live.render();\r\n  }).attr('checked', jsbin.settings.includejs);\r\n\r\n  if (!jsbin.embed && jsbin.settings.hideheader) {\r\n    jsbin.$body.addClass('hideheader');\r\n  }\r\n\r\n  var cancelUp = false;\r\n  $('form input, form textarea').focus(function () {\r\n    this.select();\r\n    cancelUp = true;\r\n  }).mouseup(function () {\r\n    if (cancelUp) {\r\n      cancelUp = false;\r\n      return false;\r\n    }\r\n  });\r\n\r\n  if (window.location.hash) {\r\n    $('a[href$=\"' + window.location.hash + '\"]').mousedown();\r\n  }\r\n\r\n  var ismac = navigator.userAgent.indexOf(' Mac ') !== -1,\r\n      mackeys = {\r\n        'ctrl': '⌘',\r\n        'shift': '⇧',\r\n        'del': '⌫'\r\n      };\r\n\r\n  $('#control').find('a[data-shortcut]').each(function () {\r\n    var $this = $(this),\r\n        data = $this.data();\r\n\r\n    var key = data.shortcut;\r\n    if (ismac) {\r\n      key = key.replace(/ctrl/i, mackeys.ctrl).replace(/shift/, mackeys.shift).replace(/del/, mackeys.del).replace(/\\+/g, '').toUpperCase();\r\n    }\r\n\r\n    $this.append('<span class=\"keyshortcut\">' + key + '</span>');\r\n  });\r\n\r\n  (function () {\r\n\r\n  var re = {\r\n    head: /<head(.*)\\n/i,\r\n    meta: /<meta name=\"description\".*?>/i,\r\n    metaContent: /content=\".*?\"/i\r\n  };\r\n\r\n  var metatag = '<meta name=\"description\" content=\"[add your bin description]\">\\n';\r\n\r\n  $('#addmeta').click(function () {\r\n    // if not - insert\r\n    // <meta name=\"description\" content=\"\" />\r\n    // if meta description is in the HTML, highlight it\r\n    var editor = panels.named.html,\r\n        cm = editor.editor,\r\n        html = editor.getCode();\r\n\r\n    if (!editor.visible) {\r\n      editor.show();\r\n    }\r\n\r\n    if (!re.meta.test(html)) {\r\n      if (re.head.test(html)) {\r\n        html = html.replace(re.head, '<head$1\\n' + metatag);\r\n      } else {\r\n        // slap in the top\r\n        html = metatag + html;\r\n      }\r\n    }\r\n\r\n    editor.setCode(html);\r\n\r\n    // now select the text\r\n    // editor.editor is the CM object...yeah, sorry about that...\r\n    var cursor = cm.getSearchCursor(re.meta);\r\n    cursor.findNext();\r\n\r\n    var contentCursor = cm.getSearchCursor(re.metaContent);\r\n    contentCursor.findNext();\r\n\r\n    var from = { line: cursor.pos.from.line, ch: cursor.pos.from.ch + '<meta name=\"description\" content=\"'.length },\r\n        to = { line: contentCursor.pos.to.line, ch: contentCursor.pos.to.ch - 1 };\r\n\r\n    cm.setCursor(from);\r\n    cm.setSelection(from, to);\r\n    cm.on('cursoractivity', function () {\r\n      cm.on('cursoractivity', null);\r\n      mark.clear();\r\n    });\r\n\r\n    var mark = cm.markText(from, to, { className: 'highlight' });\r\n\r\n    cm.focus();\r\n\r\n    return false;\r\n  });\r\n\r\n  $('a.publish-to-vanity').on('click', function (event) {\r\n    event.preventDefault();\r\n    analytics.publishVanity();\r\n\r\n    $.ajax({\r\n      type: 'post',\r\n      url: this.href,\r\n      data: { url: jsbin.getURL({ withRevision: true }) },\r\n      success: function () {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'notification',\r\n          content: 'This bin is now published to your vanity URL: <a target=\"_blank\" href=\"' + jsbin.shareRoot + '\">' + jsbin.shareRoot + '</a>'\r\n        });\r\n      },\r\n      error: function (xhr) {\r\n        jsbin.$document.trigger('tip', {\r\n          type: 'error',\r\n          content: 'There was a problem publishing to your vanity URL. Can you try again or file a <a target=\"_blank\" href=\"' + githubIssue() + '\">new issue</a>?'\r\n        });\r\n      }\r\n    })\r\n  });\r\n\r\n  jsbin.$document.on('click', 'a.deleteallbins', function () {\r\n    if (jsbin.user && jsbin.state.metadata.name === jsbin.user.name) {\r\n      if (confirm('Delete all snapshots of this bin including this one?')) {\r\n      analytics.deleteAll();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL() + '/delete-all',\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin and history is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n    } else {\r\n      jsbin.$document.trigger('tip', {\r\n        type: 'error',\r\n        content: 'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target=\"_blank\" href=\"/help/delete-a-bin\">Need help?</a>'\r\n      });\r\n    }\r\n  });\r\n\r\n  $('a.deletebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    if (confirm('Delete this bin?')) {\r\n      analytics['delete']();\r\n      $.ajax({\r\n        type: 'post',\r\n        url: jsbin.getURL({ withRevision: true }) + '/delete',\r\n        data: { checksum: jsbin.state.checksum },\r\n        success: function () {\r\n          jsbin.state.deleted = true;\r\n          jsbin.$document.trigger('tip', {\r\n            type: 'error',\r\n            content: 'This bin is now deleted. You can continue to edit, but once you leave the bin can\\'t be retrieved'\r\n          });\r\n        },\r\n        error: function (xhr) {\r\n          if (xhr.status === 403) {\r\n            jsbin.$document.trigger('tip', {\r\n              content: 'You don\\'t own this bin, so you can\\'t delete it.',\r\n              autohide: 5000\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n    }\r\n  });\r\n\r\n  $('a.archivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive();\r\n  });\r\n\r\n  $('a.unarchivebin').on('click', function (e) {\r\n    e.preventDefault();\r\n    archive(false);\r\n  });\r\n\r\n  var $enableUniversalEditor = $('#enableUniversalEditor').on('change', function (e) {\r\n    e.preventDefault();\r\n\r\n    jsbin.settings.editor.simple = this.checked;\r\n    analytics.universalEditor(jsbin.settings.editor.simple);\r\n    settings.save(function () {\r\n      window.location.reload();\r\n    });\r\n  });\r\n\r\n  if (jsbin.settings.editor.simple) {\r\n    $enableUniversalEditor.prop('checked', true);\r\n  }\r\n\r\n  $('#skipToEditor').on('click keypress', function () {\r\n    var first = (panels.getVisible() || ['html']).shift();\r\n    if (jsbin.settings.editor.simple || jsbin.mobile) {\r\n      $('#' + first.id).focus();\r\n    } else if (first) {\r\n      first.editor.focus();\r\n    } else {\r\n      panels.named.html.editor.focus();\r\n    }\r\n    return false;\r\n  });\r\n\r\n  }());\r\n\r\n});"]}