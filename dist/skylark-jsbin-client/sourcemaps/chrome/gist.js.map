{"version":3,"sources":["chrome/gist.js"],"names":["define","$","binToFile","processors","panels","jsbin","XMLHttpRequest","XDomainRequest","remove","Gist","id","gist","this","token","code","user","github_token","get","data","each","files","fileName","fileData","ext","split","slice","join","content","setCode","prototype","processorInit","findByExtension","target","panel","named","set","saveDisabled","click","public","defers","html","render","javascript","css","Promise","all","then","results","codes","Object","keys","forEach","key","extensions","file","state","length","source","getCode","index","desc","title","push","description","getURL","ajax","type","url","JSON","stringify","dataType","crossDomain","success","$document","trigger","html_url","error","xhr","status","console","group","log","groupEnd","stack"],"mappings":"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","file":"../../chrome/gist.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"skylark-jsbin-bintofile\",\r\n  \"skylark-jsbin-processors\",\r\n  \"skylark-jsbin-coder/editors/panels\",\r\n   \"../jsbin\"\r\n],function ($,binToFile, processors,panels,jsbin) {\r\n    /*global $:true, jsbin:true, processors:true, $document*/\r\n    'use strict';\r\n\r\n    // Only allow gist import/export if CORS is supported\r\n    var CORS = !!('withCredentials' in new XMLHttpRequest() ||\r\n                  typeof XDomainRequest !== 'undefined');\r\n    if (!CORS) {\r\n      return $(function () {\r\n        $('#export-as-gist').remove();\r\n      });\r\n    }\r\n\r\n    var Gist = function (id) {\r\n      var gist = this,\r\n          token = '';\r\n      gist.code = {};\r\n      if (jsbin.user && jsbin.user.github_token) { // jshint ignore:line\r\n        token = '?access_token=' + jsbin.user.github_token; // jshint ignore:line\r\n      }\r\n      $.get('https://api.github.com/gists/' + id + token, function (data) {\r\n        if (!data) {return;}\r\n        $.each(data.files, function (fileName, fileData) {\r\n          var ext = fileName.split('.').slice(-1).join('');\r\n          gist.code[ext] = fileData.content;\r\n        });\r\n        gist.setCode();\r\n      });\r\n      return this;\r\n    };\r\n\r\n    Gist.prototype.setCode = function () {\r\n      var gist = this;\r\n      $.each(gist.code, function (ext, data) {\r\n        var processorInit = jsbin.processors.findByExtension(ext),\r\n            target = processorInit.target || processorInit.id,\r\n            panel = panels.named[target];\r\n        if (!panel) {return;}\r\n        processors.set(target, processorInit.id);\r\n        jsbin.saveDisabled = true;\r\n        panel.setCode(data);\r\n        jsbin.saveDisabled = false;\r\n      });\r\n    };\r\n\r\n    /**\r\n     * Export as gist\r\n     */\r\n\r\n    $('a.export-as-gist').click(function () {\r\n      var gist = {\r\n        public: true,\r\n        files: {}\r\n      };\r\n\r\n      var defers = [\r\n        panels.named.html.render(),\r\n        panels.named.javascript.render(),\r\n        panels.named.css.render()\r\n      ];\r\n\r\n      Promise.all(defers).then(function (results) { // RSVP.hash\r\n        // Build a file name\r\n        var codes = {\r\n            html : results[0],\r\n            javascript : results[1],\r\n            css : results[2]\r\n        };\r\n        Object.keys(codes).forEach(function (key) {\r\n          var ext = processors[key].extensions ? processors[key].extensions[0] : key;\r\n          var file = ['jsbin', (jsbin.state.code || 'untitled'), ext].join('.');\r\n          if (codes[key].length) {\r\n            gist.files[file] = {\r\n              content: codes[key]\r\n            };\r\n          }\r\n        });\r\n\r\n        if (!gist.files.javascript && !gist.files.css) {\r\n          delete gist.files[['jsbin', (jsbin.state.code || 'untitled'), 'html'].join('.')]\r\n        }\r\n\r\n        if (jsbin.state.processors) {\r\n          panels.source = jsbin.state.processors;\r\n          Object.keys(panels.source).forEach(function (key) {\r\n            panels.source[key] = panels.named[key].getCode();\r\n          });\r\n        }\r\n\r\n        var index = binToFile(codes);\r\n\r\n        gist.files['index.html'] = {\r\n          content: index\r\n        };\r\n\r\n        var desc = [];\r\n\r\n        if (jsbin.state.title) {\r\n          desc.push(jsbin.state.title);\r\n        }\r\n\r\n        if (jsbin.state.description) {\r\n          desc.push(jsbin.state.description);\r\n        }\r\n\r\n        desc.push('// source ' + jsbin.getURL());\r\n\r\n        gist.description = desc.join('\\n\\n');\r\n\r\n        var token = '';\r\n        if (jsbin.user && jsbin.user.github_token) { // jshint ignore:line\r\n          token = '?access_token=' + jsbin.user.github_token; // jshint ignore:line\r\n        }\r\n\r\n        $.ajax({\r\n          type: 'POST',\r\n          url: 'https://api.github.com/gists' + token,\r\n          data: JSON.stringify(gist),\r\n          dataType: 'json',\r\n          crossDomain: true,\r\n          success: function (data) {\r\n            jsbin.$document.trigger('tip', {\r\n              type: 'notification',\r\n              content: 'Gist created! <a href=\"' + data.html_url + '\" target=\"_blank\">Open in new tab.</a>' // jshint ignore:line\r\n            });\r\n          },\r\n          error: function (xhr, status, error) {\r\n            jsbin.$document.trigger('tip', {\r\n              type: 'error',\r\n              content: 'There was a problem creating the gist: ' + error\r\n            });\r\n            console.group('gist');\r\n            console.log(gist);\r\n            console.groupEnd('gist');\r\n          }\r\n        });\r\n      }, function (error) {\r\n        console.error(error.stack);\r\n      });\r\n\r\n      // return false becuase there's weird even stuff going on. ask @rem.\r\n      return false;\r\n    });\r\n\r\n    return Gist;\r\n});"]}