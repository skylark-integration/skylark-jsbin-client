/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-coder/editors/panels","../jsbin"],function($,panels,jsbin){var global=window;function sortci(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function stringify(e,t){var n,i="",a={}.toString.call(e),s=[],r=[];if("[object String]"==a)i='"'+e.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"';else if("[object Array]"==a){for(i="[",n=0;n<e.length;n++)s.push(stringify(e[n],t));i+=s.join(", ")+"]"}else if("[object Object]"==a){for(n in i="{",e)r.push(n);for(r.sort(sortci),n=0;n<r.length;n++)s.push(stringify(r[n])+": "+stringify(e[r[n]],t));i+=s.join(", ")+"}"}else if("[object Number]"==a)i=e+"";else if("[object Boolean]"==a)i=e?"true":"false";else if("[object Function]"==a)i=e.toString();else if(null===e)i="null";else if(void 0===e)i="undefined";else if(void 0==t){for(n in i=a+"{\n",e)r.push(n);for(r.sort(sortci),n=0;n<r.length;n++)s.push(r[n]+": "+stringify(e[r[n]],!0));i+=s.join(",\n")+"\n}"}else try{i=e+""}catch(e){}return i}function addEvent(e,t){window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent("on"+e,t)}function cleanPath(e){return(""+e).replace(/[^a-z0-9\/]/gi,"")}function error(e,t){var n=JSON.stringify({response:e.message,cmd:t,type:"error"});global.remoteWindow?global.remoteWindow.postMessage(n,origin):queue.push(n)}var store=function(){var useSS;try{sessionStorage.getItem("foo"),useSS=!0}catch(e){}return{set:function(e){var t=stringify(e);return useSS?sessionStorage.spike=t:window.name=t,t},get:function(){var rawData=useSS?sessionStorage.spike:window.name,data;if(!useSS&&1==window.name||!rawData)return data;try{eval("data = "+rawData)}catch(e){}return data}}}();function restore(){var e=store.get()||{};addEvent("load",function(){window.scrollTo(e.x,e.y)})}function reload(e){store.set({y:window.scrollY,x:window.scrollX}),window.location.reload()}function renderStream(){es.addEventListener("css:processed",function(e){var t=document.getElementById("jsbin-css");t.styleSheet?t.styleSheet.cssText=e.data:t.innerHTML=e.data}),es.addEventListener("reload",reload),es.addEventListener("bump-revision",function(e){window.location.pathname=cleanPath(e.data)}),es.addEventListener("javascript:processed",reload),es.addEventListener("html:processed",reload)}function codecastStream(){if(jsbin&&panels&&panels.named){var e=panels.named;es.addEventListener("bump-revision",function(e){window.location.pathname=cleanPath(e.data)+"/edit"}),es.addEventListener("css",t),es.addEventListener("javascript",t),es.addEventListener("html",t)}function t(t){var n=t.type;if(e[n]){var i=e[n].editor.getCursor();e[n].setCode(t.data),e[n].editor.setCursor(i)}}}function isCodeCasting(){var e=location.pathname;return"/edit"===e.slice(-1*"/edit".length)||"/watch"===e.slice(-1*"/watch".length)}var id=location.pathname.replace(/\/(preview|edit|watch).*$/,""),codecasting=isCodeCasting();function startStream(){if(es=new EventSource(id+"?"+Math.random()),codecasting?codecastStream():renderStream(),window.jQuery){var e=$(document);es.addEventListener("stats",function(t){e.trigger("stats",[t.data])})}return es}function handleVisibility(e,t){var n="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null;if("visibilityState"in document?"visibilityState":"webkitVisibilityState"in document?"webkitVisibilityState":"mozVisibilityState"in document?"mozVisibilityState":null){var i=n.replace(/hidden/i,"visibilitychange");document.addEventListener(i,function(){document[n]?e.close():e=t()})}}queue=[],msgType="",useSS=!1,es=null,setTimeout(function(){es&&es.close(),es=startStream(),handleVisibility(es,startStream)},500),codecasting||(addEvent("error",function(e){error({message:e.message},e.filename+":"+e.lineno)}),restore())});
//# sourceMappingURL=sourcemaps/spike.js.map
