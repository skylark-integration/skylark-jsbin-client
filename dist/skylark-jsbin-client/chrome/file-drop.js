/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","../jsbin"],function(e,t){window.File&&window.FileList&&window.FileReader&&function(n){var r=null,o=null,i=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()}}();function s(n){var i=document.createElement("div");i.className="assetLoading",i.innerHTML="0% uploading...";var s=0,c=null,d=r||o.getCursor();if(t.lameEditor)a(o,"Uploading ...",!0);else{var u=r?r.line:o.getCursor().line;c=o.addLineWidget(u,i,{coverGutter:!1,nohscroll:!0})}new S3Upload({s3_sign_put_url:"/account/assets/sign",s3_object_name:n.name.replace(/\s+/g,"-"),files:[n],onProgress:function(e,n){t.lameEditor||requestAnimationFrame(function(){!function e(t,n){t-s<10?s=t:(s+=10,requestAnimationFrame(function(){e(t,n)})),i&&s>0&&(i.innerHTML=s>97?"97% uploaded...":s+"% uploaded...")}(e,n)})},onError:function(e,t){s=-1,console.error("Failed to upload: "+t),i.innerHTML=t||"Failed to complete",i.style.color="red",o=null,r=null,c&&setTimeout(function(){c.clear()},4e3)},onFinishS3Put:function(i){t.lameEditor?(a(o,l(n.type,o,i)),e(document).trigger("codeChange",{panelId:o.id})):(c.clear(),o.replaceRange(l(n.type,o,i),d)),o=null,r=null}})}function a(e,t,n){var r=e.selectionStart,o=e.selectionEnd,i=e,s=i.value;i.value=s.substring(0,r)+t+s.substring(o),e.selectionStart=e.selectionEnd=r+1,n?(e.selectionStart-=1,e.selectionEnd=e.selectionEnd+t.length):e.selectionStart=e.selectionEnd=r+t.length}function l(e,n,r){var o=t.state.processors[n.id];return"html"===n.id?0===e.indexOf("image/")?"markdown"===o?"!["+r+"]("+r+")":"jade"===o?'img(src="'+r+'")':'<img src="'+r+'">':r:"css"===n.id&&0===e.indexOf("image/")?"url("+r+")":r}var c=!1;function d(e){return new Promise(function(t,n){"string"===e.kind?e.getAsString(function(e){t(e)}):t(e.getAsFile())})}n.ondragover=function(){return c=!0,!1},n.ondragend=function(){return c=!1,!1},e("#bin textarea").on("paste",function(t){o=e(this).closest(".CodeMirror").length?e(this).closest(".CodeMirror")[0].CodeMirror:this;var n=t.originalEvent,r=n.clipboardData.items;if(r&&0!==n.clipboardData.types[0].indexOf("text/")){for(var a=[],l=0;l<r.length;l++)a.push(d(r[l]));Promise.all(a).then(function(e){e.sort(function(e,t){return"string"==typeof e?1:-1});var t=e[0];t.name=e[1]||i()+"."+t.type.split("/")[1],s(t)}).catch(function(e){console.log(e.stack)}),t.preventDefault()}}),e(".CodeMirror").on("mousemove",function(e){c&&(o=this.CodeMirror,r=this.CodeMirror.coordsChar({top:event.y,left:event.x}),this.CodeMirror.setCursor(r))});var u=["javascript","coffeescript","coffee","js"],f=["css","less","sass","scss"],g=["html","markdown","plain"];n.ondrop=function(n){c=!1,n.preventDefault(),o=e(n.target).closest(".CodeMirror").length?e(n.target).closest(".CodeMirror")[0].CodeMirror:n.target;var r=n.dataTransfer.files[0],i=new FileReader;if(0===r.type.indexOf("text/"))return i.onload=function(e){var n=r.type?r.type.toLowerCase().replace(/^(text|application)\//,""):r.name.toLowerCase().replace(/.*\./g,""),o=null,i=editors[o],a=(e.target.result,null);if(-1!==u.indexOf(n)?o="javascript":-1!==f.indexOf(n)?o="css":-1!==g.indexOf(n)&&(o="html"),null===o)return s(r);i=editors[o],a=i.editor.scroller,i.setCode(e.target.result),i.show();try{var l=new Worker(t.static+"/js/editors/sync-worker.js");l.postMessage(r),i.$el.find("> .label").append("<small> (live: edit & save in your fav editor)</small>"),l.onmessage=function(e){var t=a.scrollTop;i.setCode(e.data.body),a.scrollTop=t,e.data.body}}catch(e){}},i.readAsText(r),!1;s(r)}}(document.body)});
//# sourceMappingURL=../sourcemaps/chrome/file-drop.js.map
