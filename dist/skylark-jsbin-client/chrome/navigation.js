/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","../jsbin","./analytics","./archive"],function(e,t,n,o){e("a.startingpoint").click(function(e){return e.preventDefault(),localStorage?(n.saveTemplate(),localStorage.setItem("saved-javascript",editors.javascript.getCode()),localStorage.setItem("saved-html",editors.html.getCode()),localStorage.setItem("saved-css",editors.css.getCode()),localStorage.setItem("saved-processors",JSON.stringify({javascript:t.panels.named.javascript.processor.id,html:t.panels.named.html.processor.id,css:t.panels.named.css.processor.id})),t.$document.trigger("tip",{type:"notification",content:"Starting template updated and saved",autohide:3e3})):t.$document.trigger("tip",{type:"error",content:"Saving templates isn't supported in this browser I'm afraid. Sorry"}),!1});e("a.disabled").on("click mousedown mouseup",function(e){return e.stopImmediatePropagation(),!1}),e("#loginbtn").click(function(){n.login(),e(this).toggleClass("open")}),e("a.logout").click(function(t){for(t.preventDefault(),e(this.hash).submit(),i=0;i<store.sessionStorage.length;i++)key=store.sessionStorage.key(i),0===key.indexOf("jsbin.content.")&&store.sessionStorage.removeItem(key)}),e(".homebtn").click(function(o,i){return"avatar"===this.id?n.openFromAvatar():"profile"===this.id?(n.openFromAvatar(),e(this).closest(".open").removeClass("open")):n.open(i),hideOpen(),t.panels.hideAll(),!1});var s=e("div.lockrevision").on("click",function(e){e.preventDefault(),t.saveChecksum=!1,t.$document.trigger("locked")}).on("mouseup",function(){return!1});if(t.$document.on("locked",function(){s.data("locked")||(n.lock(),s.removeClass("icon-unlocked").addClass("icon-lock"),s.html("<span>This bin is now locked from further changes</span>"),s.data("locked",!0))}),t.$document.on("saved",function(){s.removeClass("icon-lock").addClass("icon-unlocked").data("locked",!1),s.html("<span>Click to lock and prevent further changes</span>")}),!e("#sharemenu .share-split").length){var a=e('#sharepanels input[type="checkbox"]').on("change",function(){updateSavedState()});e("#sharemenu").bind("open",function(){a.attr("checked",!1),t.panels.getVisible().forEach(function(e){a.filter('[data-panel="'+e.id+'"]').prop("checked",!0).change()})})}var r=!1,c=!1;function l(){if(c=!1,r){u.closest(".menu").removeClass("open").trigger("close"),r=!1,!1;var e=t.panels.focused;e&&!t.mobile&&(e.focus(),e.editor&&e.editor.focus())}}var u=e(".button-dropdown, .button-open").mousedown(function(o){return p.removeClass("hover"),r&&r!==this&&l(),r||(c=!0,function(o,i){var s;if(!r){s=e(o).closest(".menu").addClass("open").trigger("open"),n.openMenu(o.hash.substring(1));var a=s.find(":text:visible:first");a.length&&!t.mobile&&(a.focus(),setTimeout(function(){a[0].select()},0)),r=o}}(this)),o.preventDefault(),!1}).mouseup(function(){if(c)return!1}).click(function(){return c||(n.closeMenu(this.hash.substring(1)),l()),c?(e(this.hash).attr("tabindex",0),c=!1,t.mobile):(c=!1,e(this.hash).attr("tabindex",-1),!1)});e("#actionmenu").click(function(){r=!0});var d=!1;$body.bind("mousedown",function(t){r&&e(t.target).closest(".menu").length&&(d=!0)}).bind("click mouseup",function(t){if(r&&!d&&!e(t.target).closest(".menu").length)return l(),!1;d=!1});var h=!1,p=e(".dropdownmenu a, .dropdownmenu .button").mouseup(function(t){"INPUT"!==t.target.nodeName&&(setTimeout(l,0),n.selectMenu(this.getAttribute("data-label")||this.hash.substring(1)||this.href),h||(this.hostname===window.location.hostname?!1!==e(this).triggerHandler("click")&&(window.location=this.href):this.getAttribute("target")?window.open(this.href):window.location=this.href),h=!1)}).mouseover(function(){p.removeClass("hover"),e(this).addClass("hover")}).mousedown(function(e){"INPUT"!==e.target.nodeName&&(h=!0)});e("#jsbinurl").click(function(e){setTimeout(function(){t.panels.named.live.hide()},0)}),e("#runwithalerts, li.run-with-js a").click(function(e,t){return n.run(t),editors.console.visible?editors.console.render(!0):renderLivePreview(!0),!1}),e("#runconsole").click(function(){return n.runconsole(),editors.console.render(!0),!1}),e("#clearconsole").click(function(){return jsconsole.clear(),!1}),e("#showhelp").click(function(){return $body.toggleClass("keyboardHelp"),keyboardHelpVisible=$body.is(".keyboardHelp"),keyboardHelpVisible,!1}),e("a.toggle-side-nav").on(t.mobile?"touchstart":"click",function(){return $body.toggleClass("show-nav"),sideNavVisible=$body.is(".show-nav"),sideNavVisible||t.mobile||e("#skipToEditor").click(),sideNavVisible}),e("#showurls").click(function(){return $body.toggleClass("urlHelp"),urlHelpVisible=$body.is(".urlHelp"),urlHelpVisible,!1}),e(".code.panel > .label > span.name").dblclick(function(){t.panels.allEditors(function(e){var n=!e.editor.getOption("lineNumbers");e.editor.setOption("lineNumbers",n),t.settings.editor.lineNumbers=n})}),e("a.createnew").click(function(e){var o,i;for(e.preventDefault(),n.createNew(),t.panels.savecontent=function(){},o=0;o<store.sessionStorage.length;o++)0===(i=store.sessionStorage.key(o)).indexOf("jsbin.content.")&&store.sessionStorage.removeItem(i);store.sessionStorage.removeItem("checksum"),t.panels.saveOnExit=!1,t.panels.restore(),setTimeout(function(){0===t.panels.getVisible().length&&(t.panels.named.html.show(),t.panels.named.live.show()),window.location=t.root},0)});var m=e("#control a.visibilityToggle#private"),g=e("#control a.visibilityToggle#public"),f=e("#control a.visibilityToggle").click(function(n){n.preventDefault();var o=e(this).data("vis");e.ajax({url:t.getURL({withRevision:!0})+"/"+o,type:"post",success:function(e){t.$document.trigger("tip",{type:"notification",content:"This bin is now "+o,autohide:6e3}),f.css("display","none"),"public"===o?m.css("display","block"):g.css("display","block")}})});e("form.login").closest(".menu").bind("close",function(){e(this).find(".loginFeedback").empty().hide(),e("#login").removeClass("forgot")}),e("#lostpass").click(function(t){return e("#login").addClass("forgot").find("input[name=email]").focus(),!1}),t.settings.includejs=void 0===t.settings.includejs||t.settings.includejs,!t.embed&&store.sessionStorage.getItem("runnerPending")&&(t.$document.trigger("tip",{content:'It looks like your last session may have crashed, so I\'ve disabled "Auto-run JS" for you',type:"error"}),store.sessionStorage.removeItem("runnerPending"),t.settings.includejs=!1),e("#enablejs").change(function(){t.settings.includejs=this.checked,n.enableLiveJS(t.settings.includejs),editors.live.render()}).attr("checked",t.settings.includejs),!t.embed&&t.settings.hideheader&&$body.addClass("hideheader");var v=!1;e("form input, form textarea").focus(function(){this.select(),v=!0}).mouseup(function(){if(v)return v=!1,!1}),window.location.hash&&e('a[href$="'+window.location.hash+'"]').mousedown();var b=-1!==navigator.userAgent.indexOf(" Mac "),k="⌘",y="⇧",w="⌫";e("#control").find("a[data-shortcut]").each(function(){var t=e(this),n=t.data().shortcut;b&&(n=n.replace(/ctrl/i,k).replace(/shift/,y).replace(/del/,w).replace(/\+/g,"").toUpperCase()),t.append('<span class="keyshortcut">'+n+"</span>")}),function(){var i={head:/<head(.*)\n/i,meta:/<meta name="description".*?>/i,metaContent:/content=".*?"/i},s='<meta name="description" content="[add your bin description]">\n';e("#addmeta").click(function(){var e=t.panels.named.html,n=e.editor,o=e.getCode();e.visible||e.show(),i.meta.test(o)||(o=i.head.test(o)?o.replace(i.head,"<head$1\n"+s):s+o),e.setCode(o);var a=n.getSearchCursor(i.meta);a.findNext();var r=n.getSearchCursor(i.metaContent);r.findNext();var c={line:a.pos.from.line,ch:a.pos.from.ch+'<meta name="description" content="'.length},l={line:r.pos.to.line,ch:r.pos.to.ch-1};n.setCursor(c),n.setSelection(c,l),n.on("cursoractivity",function(){n.on("cursoractivity",null),u.clear()});var u=n.markText(c,l,{className:"highlight"});return n.focus(),!1}),e("a.publish-to-vanity").on("click",function(o){o.preventDefault(),n.publishVanity(),e.ajax({type:"post",url:this.href,data:{url:t.getURL({withRevision:!0})},success:function(){t.$document.trigger("tip",{type:"notification",content:'This bin is now published to your vanity URL: <a target="_blank" href="'+t.shareRoot+'">'+t.shareRoot+"</a>"})},error:function(e){t.$document.trigger("tip",{type:"error",content:'There was a problem publishing to your vanity URL. Can you try again or file a <a target="_blank" href="'+githubIssue()+'">new issue</a>?'})}})}),t.$document.on("click","a.deleteallbins",function(){t.user&&t.state.metadata.name===t.user.name?confirm("Delete all snapshots of this bin including this one?")&&(n.deleteAll(),e.ajax({type:"post",url:t.getURL()+"/delete-all",success:function(){t.state.deleted=!0,t.$document.trigger("tip",{type:"error",content:"This bin and history is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&t.$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}})):t.$document.trigger("tip",{type:"error",content:'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target="_blank" href="/help/delete-a-bin">Need help?</a>'})}),e("a.deletebin").on("click",function(o){o.preventDefault(),confirm("Delete this bin?")&&(n.delete(),e.ajax({type:"post",url:t.getURL({withRevision:!0})+"/delete",data:{checksum:t.state.checksum},success:function(){t.state.deleted=!0,t.$document.trigger("tip",{type:"error",content:"This bin is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&t.$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}}))}),e("a.archivebin").on("click",function(e){e.preventDefault(),o()}),e("a.unarchivebin").on("click",function(e){e.preventDefault(),o(!1)});var a=e("#enableUniversalEditor").on("change",function(e){e.preventDefault(),t.settings.editor.simple=this.checked,n.universalEditor(t.settings.editor.simple),settings.save(function(){window.location.reload()})});t.settings.editor.simple&&a.prop("checked",!0),e("#skipToEditor").on("click keypress",function(){var n=(t.panels.getVisible()||["html"]).shift();return t.settings.editor.simple||t.mobile?e("#"+n.id).focus():n?n.editor.focus():t.panels.named.html.editor.focus(),!1})}()});
//# sourceMappingURL=../sourcemaps/chrome/navigation.js.map
