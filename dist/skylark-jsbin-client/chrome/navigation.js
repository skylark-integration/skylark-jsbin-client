/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-base/storage","skylark-jsbin-chrome/hideOpen","skylark-jsbin-coder/editors/panels","../jsbin","./analytics","./archive"],function(e,t,n,o,s,a,r){e("a.startingpoint").click(function(e){return e.preventDefault(),localStorage?(a.saveTemplate(),localStorage.setItem("saved-javascript",o.named.javascript.getCode()),localStorage.setItem("saved-html",o.named.html.getCode()),localStorage.setItem("saved-css",o.named.css.getCode()),localStorage.setItem("saved-processors",JSON.stringify({javascript:s.panels.named.javascript.processor.id,html:s.panels.named.html.processor.id,css:s.panels.named.css.processor.id})),s.$document.trigger("tip",{type:"notification",content:"Starting template updated and saved",autohide:3e3})):s.$document.trigger("tip",{type:"error",content:"Saving templates isn't supported in this browser I'm afraid. Sorry"}),!1});e("a.disabled").on("click mousedown mouseup",function(e){return e.stopImmediatePropagation(),!1}),e("#loginbtn").click(function(){a.login(),e(this).toggleClass("open")}),e("a.logout").click(function(n){for(n.preventDefault(),e(this.hash).submit(),i=0;i<t.sessionStorage.length;i++)key=t.sessionStorage.key(i),0===key.indexOf("jsbin.content.")&&t.sessionStorage.removeItem(key)}),e(".homebtn").click(function(t,i){return"avatar"===this.id?a.openFromAvatar():"profile"===this.id?(a.openFromAvatar(),e(this).closest(".open").removeClass("open")):a.open(i),n(),s.panels.hideAll(),!1});var c=e("div.lockrevision").on("click",function(e){e.preventDefault(),s.saveChecksum=!1,s.$document.trigger("locked")}).on("mouseup",function(){return!1});if(s.$document.on("locked",function(){c.data("locked")||(a.lock(),c.removeClass("icon-unlocked").addClass("icon-lock"),c.html("<span>This bin is now locked from further changes</span>"),c.data("locked",!0))}),s.$document.on("saved",function(){c.removeClass("icon-lock").addClass("icon-unlocked").data("locked",!1),c.html("<span>Click to lock and prevent further changes</span>")}),!e("#sharemenu .share-split").length){var l=e('#sharepanels input[type="checkbox"]').on("change",function(){updateSavedState()});e("#sharemenu").bind("open",function(){l.attr("checked",!1),s.panels.getVisible().forEach(function(e){l.filter('[data-panel="'+e.id+'"]').prop("checked",!0).change()})})}e("#jsbinurl").click(function(e){setTimeout(function(){s.panels.named.live.hide()},0)}),e("#runwithalerts, li.run-with-js a").click(function(e,t){return a.run(t),o.named.console.visible?o.named.console.render(!0):renderLivePreview(!0),!1}),e("#runconsole").click(function(){return a.runconsole(),o.named.console.render(!0),!1}),e("#clearconsole").click(function(){return jsconsole.clear(),!1}),e("#showhelp").click(function(){return $body.toggleClass("keyboardHelp"),keyboardHelpVisible=$body.is(".keyboardHelp"),keyboardHelpVisible,!1}),e("a.toggle-side-nav").on(s.mobile?"touchstart":"click",function(){return $body.toggleClass("show-nav"),sideNavVisible=$body.is(".show-nav"),sideNavVisible||s.mobile||e("#skipToEditor").click(),sideNavVisible}),e("#showurls").click(function(){return $body.toggleClass("urlHelp"),urlHelpVisible=$body.is(".urlHelp"),urlHelpVisible,!1}),e(".code.panel > .label > span.name").dblclick(function(){s.panels.allEditors(function(e){var t=!e.editor.getOption("lineNumbers");e.editor.setOption("lineNumbers",t),s.settings.editor.lineNumbers=t})}),e("a.createnew").click(function(e){var n,i;for(e.preventDefault(),a.createNew(),s.panels.savecontent=function(){},n=0;n<t.sessionStorage.length;n++)0===(i=t.sessionStorage.key(n)).indexOf("jsbin.content.")&&t.sessionStorage.removeItem(i);t.sessionStorage.removeItem("checksum"),s.panels.saveOnExit=!1,s.panels.restore(),setTimeout(function(){0===s.panels.getVisible().length&&(s.panels.named.html.show(),s.panels.named.live.show()),window.location=s.root},0)});var d=e("#control a.visibilityToggle#private"),u=e("#control a.visibilityToggle#public"),p=e("#control a.visibilityToggle").click(function(t){t.preventDefault();var n=e(this).data("vis");e.ajax({url:s.getURL({withRevision:!0})+"/"+n,type:"post",success:function(e){s.$document.trigger("tip",{type:"notification",content:"This bin is now "+n,autohide:6e3}),p.css("display","none"),"public"===n?d.css("display","block"):u.css("display","block")}})});e("form.login").closest(".menu").bind("close",function(){e(this).find(".loginFeedback").empty().hide(),e("#login").removeClass("forgot")}),e("#lostpass").click(function(t){return e("#login").addClass("forgot").find("input[name=email]").focus(),!1}),s.settings.includejs=void 0===s.settings.includejs||s.settings.includejs,!s.embed&&t.sessionStorage.getItem("runnerPending")&&(s.$document.trigger("tip",{content:'It looks like your last session may have crashed, so I\'ve disabled "Auto-run JS" for you',type:"error"}),t.sessionStorage.removeItem("runnerPending"),s.settings.includejs=!1),e("#enablejs").change(function(){s.settings.includejs=this.checked,a.enableLiveJS(s.settings.includejs),o.named.live.render()}).attr("checked",s.settings.includejs),!s.embed&&s.settings.hideheader&&s.$body.addClass("hideheader");var h=!1;e("form input, form textarea").focus(function(){this.select(),h=!0}).mouseup(function(){if(h)return h=!1,!1}),window.location.hash&&e('a[href$="'+window.location.hash+'"]').mousedown();var m=-1!==navigator.userAgent.indexOf(" Mac "),g="⌘",f="⇧",v="⌫";e("#control").find("a[data-shortcut]").each(function(){var t=e(this),n=t.data().shortcut;m&&(n=n.replace(/ctrl/i,g).replace(/shift/,f).replace(/del/,v).replace(/\+/g,"").toUpperCase()),t.append('<span class="keyshortcut">'+n+"</span>")}),function(){var t={head:/<head(.*)\n/i,meta:/<meta name="description".*?>/i,metaContent:/content=".*?"/i},n='<meta name="description" content="[add your bin description]">\n';e("#addmeta").click(function(){var e=s.panels.named.html,i=e.editor,o=e.getCode();e.visible||e.show(),t.meta.test(o)||(o=t.head.test(o)?o.replace(t.head,"<head$1\n"+n):n+o),e.setCode(o);var a=i.getSearchCursor(t.meta);a.findNext();var r=i.getSearchCursor(t.metaContent);r.findNext();var c={line:a.pos.from.line,ch:a.pos.from.ch+'<meta name="description" content="'.length},l={line:r.pos.to.line,ch:r.pos.to.ch-1};i.setCursor(c),i.setSelection(c,l),i.on("cursoractivity",function(){i.on("cursoractivity",null),d.clear()});var d=i.markText(c,l,{className:"highlight"});return i.focus(),!1}),e("a.publish-to-vanity").on("click",function(t){t.preventDefault(),a.publishVanity(),e.ajax({type:"post",url:this.href,data:{url:s.getURL({withRevision:!0})},success:function(){s.$document.trigger("tip",{type:"notification",content:'This bin is now published to your vanity URL: <a target="_blank" href="'+s.shareRoot+'">'+s.shareRoot+"</a>"})},error:function(e){s.$document.trigger("tip",{type:"error",content:'There was a problem publishing to your vanity URL. Can you try again or file a <a target="_blank" href="'+githubIssue()+'">new issue</a>?'})}})}),s.$document.on("click","a.deleteallbins",function(){s.user&&s.state.metadata.name===s.user.name?confirm("Delete all snapshots of this bin including this one?")&&(a.deleteAll(),e.ajax({type:"post",url:s.getURL()+"/delete-all",success:function(){s.state.deleted=!0,s.$document.trigger("tip",{type:"error",content:"This bin and history is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&s.$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}})):s.$document.trigger("tip",{type:"error",content:'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target="_blank" href="/help/delete-a-bin">Need help?</a>'})}),e("a.deletebin").on("click",function(t){t.preventDefault(),confirm("Delete this bin?")&&(a.delete(),e.ajax({type:"post",url:s.getURL({withRevision:!0})+"/delete",data:{checksum:s.state.checksum},success:function(){s.state.deleted=!0,s.$document.trigger("tip",{type:"error",content:"This bin is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&s.$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}}))}),e("a.archivebin").on("click",function(e){e.preventDefault(),r()}),e("a.unarchivebin").on("click",function(e){e.preventDefault(),r(!1)});var i=e("#enableUniversalEditor").on("change",function(e){e.preventDefault(),s.settings.editor.simple=this.checked,a.universalEditor(s.settings.editor.simple),settings.save(function(){window.location.reload()})});s.settings.editor.simple&&i.prop("checked",!0),e("#skipToEditor").on("click keypress",function(){var t=(s.panels.getVisible()||["html"]).shift();return s.settings.editor.simple||s.mobile?e("#"+t.id).focus():t?t.editor.focus():s.panels.named.html.editor.focus(),!1})}()});
//# sourceMappingURL=../sourcemaps/chrome/navigation.js.map
