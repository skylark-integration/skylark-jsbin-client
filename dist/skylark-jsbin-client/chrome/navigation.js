/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","../jsbin"],function(e,t){e("a.startingpoint").click(function(e){return e.preventDefault(),localStorage?(analytics.saveTemplate(),localStorage.setItem("saved-javascript",editors.javascript.getCode()),localStorage.setItem("saved-html",editors.html.getCode()),localStorage.setItem("saved-css",editors.css.getCode()),localStorage.setItem("saved-processors",JSON.stringify({javascript:t.panels.panels.javascript.processor.id,html:t.panels.panels.html.processor.id,css:t.panels.panels.css.processor.id})),$document.trigger("tip",{type:"notification",content:"Starting template updated and saved",autohide:3e3})):$document.trigger("tip",{type:"error",content:"Saving templates isn't supported in this browser I'm afraid. Sorry"}),!1});e("a.disabled").on("click mousedown mouseup",function(e){return e.stopImmediatePropagation(),!1}),e("#loginbtn").click(function(){analytics.login(),e(this).toggleClass("open")}),e("a.logout").click(function(t){for(t.preventDefault(),e(this.hash).submit(),i=0;i<store.sessionStorage.length;i++)key=store.sessionStorage.key(i),0===key.indexOf("jsbin.content.")&&store.sessionStorage.removeItem(key)}),e(".homebtn").click(function(n,i){return"avatar"===this.id?analytics.openFromAvatar():"profile"===this.id?(analytics.openFromAvatar(),e(this).closest(".open").removeClass("open")):analytics.open(i),hideOpen(),t.panels.hideAll(),!1});var n=e("div.lockrevision").on("click",function(e){e.preventDefault(),saveChecksum=!1,$document.trigger("locked")}).on("mouseup",function(){return!1});if($document.on("locked",function(){n.data("locked")||(analytics.lock(),n.removeClass("icon-unlocked").addClass("icon-lock"),n.html("<span>This bin is now locked from further changes</span>"),n.data("locked",!0))}),$document.on("saved",function(){n.removeClass("icon-lock").addClass("icon-unlocked").data("locked",!1),n.html("<span>Click to lock and prevent further changes</span>")}),!e("#sharemenu .share-split").length){var o=e('#sharepanels input[type="checkbox"]').on("change",function(){updateSavedState()});e("#sharemenu").bind("open",function(){o.attr("checked",!1),t.panels.getVisible().forEach(function(e){o.filter('[data-panel="'+e.id+'"]').prop("checked",!0).change()})})}var s=!1,a=!1;function r(){if(a=!1,s){c.closest(".menu").removeClass("open").trigger("close"),s=!1,!1;var e=t.panels.focused;e&&!t.mobile&&(e.focus(),e.editor&&e.editor.focus())}}var c=e(".button-dropdown, .button-open").mousedown(function(n){return d.removeClass("hover"),s&&s!==this&&r(),s||(a=!0,function(n,i){var o;if(!s){o=e(n).closest(".menu").addClass("open").trigger("open"),analytics.openMenu(n.hash.substring(1));var a=o.find(":text:visible:first");a.length&&!t.mobile&&(a.focus(),setTimeout(function(){a[0].select()},0)),s=n}}(this)),n.preventDefault(),!1}).mouseup(function(){if(a)return!1}).click(function(){return a||(analytics.closeMenu(this.hash.substring(1)),r()),a?(e(this.hash).attr("tabindex",0),a=!1,t.mobile):(a=!1,e(this.hash).attr("tabindex",-1),!1)});e("#actionmenu").click(function(){s=!0});var l=!1;$body.bind("mousedown",function(t){s&&e(t.target).closest(".menu").length&&(l=!0)}).bind("click mouseup",function(t){if(s&&!l&&!e(t.target).closest(".menu").length)return r(),!1;l=!1});var u=!1,d=e(".dropdownmenu a, .dropdownmenu .button").mouseup(function(t){"INPUT"!==t.target.nodeName&&(setTimeout(r,0),analytics.selectMenu(this.getAttribute("data-label")||this.hash.substring(1)||this.href),u||(this.hostname===window.location.hostname?!1!==e(this).triggerHandler("click")&&(window.location=this.href):this.getAttribute("target")?window.open(this.href):window.location=this.href),u=!1)}).mouseover(function(){d.removeClass("hover"),e(this).addClass("hover")}).mousedown(function(e){"INPUT"!==e.target.nodeName&&(u=!0)});e("#jsbinurl").click(function(e){setTimeout(function(){t.panels.panels.live.hide()},0)}),e("#runwithalerts, li.run-with-js a").click(function(e,t){return analytics.run(t),editors.console.visible?editors.console.render(!0):renderLivePreview(!0),!1}),e("#runconsole").click(function(){return analytics.runconsole(),editors.console.render(!0),!1}),e("#clearconsole").click(function(){return jsconsole.clear(),!1}),e("#showhelp").click(function(){return $body.toggleClass("keyboardHelp"),keyboardHelpVisible=$body.is(".keyboardHelp"),keyboardHelpVisible,!1}),e("a.toggle-side-nav").on(t.mobile?"touchstart":"click",function(){return $body.toggleClass("show-nav"),sideNavVisible=$body.is(".show-nav"),sideNavVisible||t.mobile||e("#skipToEditor").click(),sideNavVisible}),e("#showurls").click(function(){return $body.toggleClass("urlHelp"),urlHelpVisible=$body.is(".urlHelp"),urlHelpVisible,!1}),e(".code.panel > .label > span.name").dblclick(function(){t.panels.allEditors(function(e){var n=!e.editor.getOption("lineNumbers");e.editor.setOption("lineNumbers",n),t.settings.editor.lineNumbers=n})}),e("a.createnew").click(function(e){var n,i;for(e.preventDefault(),analytics.createNew(),t.panels.savecontent=function(){},n=0;n<store.sessionStorage.length;n++)0===(i=store.sessionStorage.key(n)).indexOf("jsbin.content.")&&store.sessionStorage.removeItem(i);store.sessionStorage.removeItem("checksum"),t.panels.saveOnExit=!1,t.panels.restore(),setTimeout(function(){0===t.panels.getVisible().length&&(t.panels.panels.html.show(),t.panels.panels.live.show()),window.location=t.root},0)});var h=e("#control a.visibilityToggle#private"),p=e("#control a.visibilityToggle#public"),g=e("#control a.visibilityToggle").click(function(n){n.preventDefault();var i=e(this).data("vis");e.ajax({url:t.getURL({withRevision:!0})+"/"+i,type:"post",success:function(e){$document.trigger("tip",{type:"notification",content:"This bin is now "+i,autohide:6e3}),g.css("display","none"),"public"===i?h.css("display","block"):p.css("display","block")}})});e("form.login").closest(".menu").bind("close",function(){e(this).find(".loginFeedback").empty().hide(),e("#login").removeClass("forgot")}),e("#lostpass").click(function(t){return e("#login").addClass("forgot").find("input[name=email]").focus(),!1}),t.settings.includejs=void 0===t.settings.includejs||t.settings.includejs,!t.embed&&store.sessionStorage.getItem("runnerPending")&&($document.trigger("tip",{content:'It looks like your last session may have crashed, so I\'ve disabled "Auto-run JS" for you',type:"error"}),store.sessionStorage.removeItem("runnerPending"),t.settings.includejs=!1),e("#enablejs").change(function(){t.settings.includejs=this.checked,analytics.enableLiveJS(t.settings.includejs),editors.live.render()}).attr("checked",t.settings.includejs),!t.embed&&t.settings.hideheader&&$body.addClass("hideheader");var m=!1;e("form input, form textarea").focus(function(){this.select(),m=!0}).mouseup(function(){if(m)return m=!1,!1}),window.location.hash&&e('a[href$="'+window.location.hash+'"]').mousedown();var f=-1!==navigator.userAgent.indexOf(" Mac "),v="⌘",b="⇧",y="⌫";e("#control").find("a[data-shortcut]").each(function(){var t=e(this),n=t.data().shortcut;f&&(n=n.replace(/ctrl/i,v).replace(/shift/,b).replace(/del/,y).replace(/\+/g,"").toUpperCase()),t.append('<span class="keyshortcut">'+n+"</span>")}),function(){var n={head:/<head(.*)\n/i,meta:/<meta name="description".*?>/i,metaContent:/content=".*?"/i},i='<meta name="description" content="[add your bin description]">\n';e("#addmeta").click(function(){var e=t.panels.panels.html,o=e.editor,s=e.getCode();e.visible||e.show(),n.meta.test(s)||(s=n.head.test(s)?s.replace(n.head,"<head$1\n"+i):i+s),e.setCode(s);var a=o.getSearchCursor(n.meta);a.findNext();var r=o.getSearchCursor(n.metaContent);r.findNext();var c={line:a.pos.from.line,ch:a.pos.from.ch+'<meta name="description" content="'.length},l={line:r.pos.to.line,ch:r.pos.to.ch-1};o.setCursor(c),o.setSelection(c,l),o.on("cursoractivity",function(){o.on("cursoractivity",null),u.clear()});var u=o.markText(c,l,{className:"highlight"});return o.focus(),!1}),e("a.publish-to-vanity").on("click",function(n){n.preventDefault(),analytics.publishVanity(),e.ajax({type:"post",url:this.href,data:{url:t.getURL({withRevision:!0})},success:function(){$document.trigger("tip",{type:"notification",content:'This bin is now published to your vanity URL: <a target="_blank" href="'+t.shareRoot+'">'+t.shareRoot+"</a>"})},error:function(e){$document.trigger("tip",{type:"error",content:'There was a problem publishing to your vanity URL. Can you try again or file a <a target="_blank" href="'+githubIssue()+'">new issue</a>?'})}})}),$document.on("click","a.deleteallbins",function(){t.user&&t.state.metadata.name===t.user.name?confirm("Delete all snapshots of this bin including this one?")&&(analytics.deleteAll(),e.ajax({type:"post",url:t.getURL()+"/delete-all",success:function(){t.state.deleted=!0,$document.trigger("tip",{type:"error",content:"This bin and history is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}})):$document.trigger("tip",{type:"error",content:'You must be logged in <em><strong>the bin owner</strong></em> to delete all snapshots. <a target="_blank" href="/help/delete-a-bin">Need help?</a>'})}),e("a.deletebin").on("click",function(n){n.preventDefault(),confirm("Delete this bin?")&&(analytics.delete(),e.ajax({type:"post",url:t.getURL({withRevision:!0})+"/delete",data:{checksum:t.state.checksum},success:function(){t.state.deleted=!0,$document.trigger("tip",{type:"error",content:"This bin is now deleted. You can continue to edit, but once you leave the bin can't be retrieved"})},error:function(e){403===e.status&&$document.trigger("tip",{content:"You don't own this bin, so you can't delete it.",autohide:5e3})}}))}),e("a.archivebin").on("click",function(e){e.preventDefault(),archive()}),e("a.unarchivebin").on("click",function(e){e.preventDefault(),archive(!1)});var o=e("#enableUniversalEditor").on("change",function(e){e.preventDefault(),t.settings.editor.simple=this.checked,analytics.universalEditor(t.settings.editor.simple),settings.save(function(){window.location.reload()})});t.settings.editor.simple&&o.prop("checked",!0),e("#skipToEditor").on("click keypress",function(){var n=(t.panels.getVisible()||["html"]).shift();return t.settings.editor.simple||t.mobile?e("#"+n.id).focus():n?n.editor.focus():t.panels.panels.html.editor.focus(),!1})}()});
//# sourceMappingURL=../sourcemaps/chrome/navigation.js.map
