/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-coder/editors/panels","../jsbin"],function(e,t,s){"use strict";if(!!!("withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest))return e(function(){e("#export-as-gist").remove()});var n=function(t){var n=this,i="";return n.code={},s.user&&s.user.github_token&&(i="?access_token="+s.user.github_token),e.get("https://api.github.com/gists/"+t+i,function(t){t&&(e.each(t.files,function(e,t){var s=e.split(".").slice(-1).join("");n.code[s]=t.content}),n.setCode())}),this};return n.prototype.setCode=function(){e.each(this.code,function(e,n){var i=s.processors.findByExtension(e),o=i.target||i.id,r=t.named[o];r&&(processors.set(o,i.id),s.saveDisabled=!0,r.setCode(n),s.saveDisabled=!1)})},e("a.export-as-gist").click(function(){var t={public:!0,files:{}},n={html:n.named.html.render(),javascript:n.named.javascript.render(),css:n.named.css.render()};return Promise.all(n).then(function(n){Object.keys(n).forEach(function(e){var i=processors[e].extensions?processors[e].extensions[0]:e,o=["jsbin",s.state.code||"untitled",i].join(".");n[e].length&&(t.files[o]={content:n[e]})}),t.files.javascript||t.files.css||delete t.files[["jsbin",s.state.code||"untitled","html"].join(".")],s.state.processors&&(n.source=s.state.processors,Object.keys(n.source).forEach(function(e){n.source[e]=s.panels.panels[e].getCode()}));var i=binToFile(n);t.files["index.html"]={content:i};var o=[];s.state.title&&o.push(s.state.title),s.state.description&&o.push(s.state.description),o.push("// source "+s.getURL()),t.description=o.join("\n\n");var r="";s.user&&s.user.github_token&&(r="?access_token="+s.user.github_token),e.ajax({type:"POST",url:"https://api.github.com/gists"+r,data:JSON.stringify(t),dataType:"json",crossDomain:!0,success:function(e){s.$document.trigger("tip",{type:"notification",content:'Gist created! <a href="'+e.html_url+'" target="_blank">Open in new tab.</a>'})},error:function(e,n,i){s.$document.trigger("tip",{type:"error",content:"There was a problem creating the gist: "+i}),console.group("gist"),console.log(t),console.groupEnd("gist")}})},function(e){console.error(e.stack)}),!1}),n});
//# sourceMappingURL=../sourcemaps/chrome/gist.js.map
