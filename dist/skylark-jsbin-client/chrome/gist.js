/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-processors","skylark-jsbin-coder/editors/panels","../jsbin"],function(e,t,s,n){"use strict";if(!!!("withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest))return e(function(){e("#export-as-gist").remove()});var i=function(t){var s=this,i="";return s.code={},n.user&&n.user.github_token&&(i="?access_token="+n.user.github_token),e.get("https://api.github.com/gists/"+t+i,function(t){t&&(e.each(t.files,function(e,t){var n=e.split(".").slice(-1).join("");s.code[n]=t.content}),s.setCode())}),this};return i.prototype.setCode=function(){e.each(this.code,function(e,i){var o=n.processors.findByExtension(e),r=o.target||o.id,c=s.named[r];c&&(t.set(r,o.id),n.saveDisabled=!0,c.setCode(i),n.saveDisabled=!1)})},e("a.export-as-gist").click(function(){var s={public:!0,files:{}},i={html:i.named.html.render(),javascript:i.named.javascript.render(),css:i.named.css.render()};return Promise.all(i).then(function(i){Object.keys(i).forEach(function(e){var o=t[e].extensions?t[e].extensions[0]:e,r=["jsbin",n.state.code||"untitled",o].join(".");i[e].length&&(s.files[r]={content:i[e]})}),s.files.javascript||s.files.css||delete s.files[["jsbin",n.state.code||"untitled","html"].join(".")],n.state.processors&&(i.source=n.state.processors,Object.keys(i.source).forEach(function(e){i.source[e]=i.named[e].getCode()}));var o=binToFile(i);s.files["index.html"]={content:o};var r=[];n.state.title&&r.push(n.state.title),n.state.description&&r.push(n.state.description),r.push("// source "+n.getURL()),s.description=r.join("\n\n");var c="";n.user&&n.user.github_token&&(c="?access_token="+n.user.github_token),e.ajax({type:"POST",url:"https://api.github.com/gists"+c,data:JSON.stringify(s),dataType:"json",crossDomain:!0,success:function(e){n.$document.trigger("tip",{type:"notification",content:'Gist created! <a href="'+e.html_url+'" target="_blank">Open in new tab.</a>'})},error:function(e,t,i){n.$document.trigger("tip",{type:"error",content:"There was a problem creating the gist: "+i}),console.group("gist"),console.log(s),console.groupEnd("gist")}})},function(e){console.error(e.stack)}),!1}),i});
//# sourceMappingURL=../sourcemaps/chrome/gist.js.map
