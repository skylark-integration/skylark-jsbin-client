/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","skylark-jsbin-coder/editors/panels","../jsbin"],function(e,t,a){"use strict";if(a.user&&a.user.name&&!a.embed){var i,r=e("body"),n=!1,o=5;a.$document.on("history:open",function(){i&&0===t.getVisible().length&&i.appendTo("main")}).on("history:close",function(){null===i&&(i=e("#history").detach())});var s=function(){n||(e("html").hasClass("public-listing")?h():e.ajax({dataType:"html",url:a.root+"/list",error:function(){--o>0?(e("#history").remove(),setTimeout(s,500)):console.error("Giving up to load history")},success:function(t){e("#history").remove();var i=e(t);a.mobile&&i.find("tbody:gt(50)").remove(),r.append(i),h(),n=!0}}))},l=function(e,t){t.attr("src",e+"/quiet"),t.removeAttr("hidden")},c=function(e,t){t.html('<a href="'+e+'">'+e+"</a>")},d=function(t,a){var i=t.parent();t.detach().each(function(){var t=e(this),i=e("tr"+(a?".archived":":not(.archived)"),t).filter(":not(.spacer)");i.length>0?(i.filter(".first").removeClass("first"),t.removeClass("hidden"),i.first().addClass("first")):t.addClass("hidden")}).appendTo(i)},h=function(){if(!(i=e("#history").detach()).length)return i;var r=e("iframe",i),n=e("#viewing",i),o=i,s=e("tbody",i),h=e("tr",i),u=e(".toggle_archive",i);o.delegate(".archive, .unarchive","click",function(){var t=e(this),r=t.parents("tr");return r.toggleClass("archived"),analytics[-1===this.pathname.indexOf("unarchive")?"archive":"unarchive"](a.root+r.data("url")),d(s,i.hasClass("archive_mode")),e.ajax({type:"POST",url:t.attr("href"),error:function(){alert("Something went wrong, please try again"),r.toggleClass("archived"),d(s,i.hasClass("archive_mode"))},success:function(){}}),!1}),u.change(function(){i.toggleClass("archive_mode");var e=i.hasClass("archive_mode");analytics.archiveView(e),d(s,e)});var f=null;return o.delegate("a","click",function(i){if(!i.shiftKey&&!i.metaKey){var o=e(this);if(!o.closest(".action").length)if(i.preventDefault(),i.stopImmediatePropagation(),"history"!==o.data("toggle")){var s=o.closest("tr"),d=s.data(),u=a.root+d.url;f===this?window.location=d.editUrl:(h.removeClass("selected"),s.addClass("selected"),l(u,r),c(u,n),f=this)}else t.allEditors(function(e){e.editor.getCode().trim().length&&e.show()})}}),o.delegate("tr:not(.spacer)","click",function(t){t.shiftKey||t.metaKey||e(this).find(".url a:first").click()}),e("a[pubdate]",i).attr("pubdate",function(e,t){return t.replace("Z","+0000")}).prettyDate(),setTimeout(function(){d(s,!1)},0),a.$document.trigger("history:open"),i};return e(document).on("jsbinReady",function(){if(!a.embed){var t=e("#panels a"),i=e(".homebtn"),n=r.hasClass("panelsVisible");i.on("click",s),t.on("mousedown",function(){1===t.filter(".active").length&&e(this).hasClass("active")&&s()}),a.$document.on("history:load",s),n||s()}}),{loadList:s,updatePreview:l,updateViewing:c,updateLayout:d,hookUserHistory:h}}});
//# sourceMappingURL=../sourcemaps/render/saved-history-preview.js.map
