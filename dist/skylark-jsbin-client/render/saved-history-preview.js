/**
 * skylark-jsbin-client - A version of jsbin-editor  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-client/
 * @license MIT
 */
define(["skylark-jquery","../jsbin"],function(e,t){"use strict";if(t.user&&t.user.name&&!t.embed){var a,i=e("body"),r=!1,n=5;$document.on("history:open",function(){a&&0===t.panels.getVisible().length&&a.appendTo("main")}).on("history:close",function(){null===a&&(a=e("#history").detach())});var o=function(){r||(e("html").hasClass("public-listing")?h():e.ajax({dataType:"html",url:t.root+"/list",error:function(){--n>0?(e("#history").remove(),setTimeout(o,500)):console.error("Giving up to load history")},success:function(a){e("#history").remove();var n=e(a);t.mobile&&n.find("tbody:gt(50)").remove(),i.append(n),h(),r=!0}}))},s=function(e,t){t.attr("src",e+"/quiet"),t.removeAttr("hidden")},l=function(e,t){t.html('<a href="'+e+'">'+e+"</a>")},c=function(t,a){var i=t.parent();t.detach().each(function(){var t=e(this),i=e("tr"+(a?".archived":":not(.archived)"),t).filter(":not(.spacer)");i.length>0?(i.filter(".first").removeClass("first"),t.removeClass("hidden"),i.first().addClass("first")):t.addClass("hidden")}).appendTo(i)},h=function(){if(!(a=e("#history").detach()).length)return a;var i=e("iframe",a),r=e("#viewing",a),n=a,o=e("tbody",a),h=e("tr",a),d=e(".toggle_archive",a);n.delegate(".archive, .unarchive","click",function(){var i=e(this),r=i.parents("tr");return r.toggleClass("archived"),analytics[-1===this.pathname.indexOf("unarchive")?"archive":"unarchive"](t.root+r.data("url")),c(o,a.hasClass("archive_mode")),e.ajax({type:"POST",url:i.attr("href"),error:function(){alert("Something went wrong, please try again"),r.toggleClass("archived"),c(o,a.hasClass("archive_mode"))},success:function(){}}),!1}),d.change(function(){a.toggleClass("archive_mode");var e=a.hasClass("archive_mode");analytics.archiveView(e),c(o,e)});var u=null;return n.delegate("a","click",function(a){if(!a.shiftKey&&!a.metaKey){var n=e(this);if(!n.closest(".action").length)if(a.preventDefault(),a.stopImmediatePropagation(),"history"!==n.data("toggle")){var o=n.closest("tr"),c=o.data(),d=t.root+c.url;u===this?window.location=c.editUrl:(h.removeClass("selected"),o.addClass("selected"),s(d,i),l(d,r),u=this)}else t.panels.allEditors(function(e){e.editor.getCode().trim().length&&e.show()})}}),n.delegate("tr:not(.spacer)","click",function(t){t.shiftKey||t.metaKey||e(this).find(".url a:first").click()}),e("a[pubdate]",a).attr("pubdate",function(e,t){return t.replace("Z","+0000")}).prettyDate(),setTimeout(function(){c(o,!1)},0),$document.trigger("history:open"),a};return e(document).on("jsbinReady",function(){if(!t.embed){var a=e("#panels a"),r=e(".homebtn"),n=i.hasClass("panelsVisible");r.on("click",o),a.on("mousedown",function(){1===a.filter(".active").length&&e(this).hasClass("active")&&o()}),$document.on("history:load",o),n||o()}}),{loadList:o,updatePreview:s,updateViewing:l,updateLayout:c,hookUserHistory:h}}});
//# sourceMappingURL=../sourcemaps/render/saved-history-preview.js.map
